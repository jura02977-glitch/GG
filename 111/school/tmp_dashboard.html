{% load static %}
﻿
<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tableau de Bord - GénieSchool</title>
  <script src="{% static 'static/vendor/js/tailwind.js' %}"></script>
  <link href="{% static 'static/vendor/fonts/css2_8b874a3a' %}" rel="stylesheet"/>
  <link href="{% static 'static/vendor/fonts/css2_d26a7969' %}" rel="stylesheet"/>
      <link href="{% static 'static/vendor/fonts/css2_293c20c8' %}" rel="stylesheet"/>
  <style type="text/tailwindcss">
    /* Theme variables (light defaults) */
    :root {
      --app-green: #16a34a;
      --app-green-2: #059669;
      --bg-primary: #f7fafc; /* page background */
      --bg-card: #ffffff; /* cards / modals */
      --bg-sidebar: linear-gradient(180deg,#ffffff,#f8fafc);
      --sidebar-border: rgba(2,6,23,0.04);
      --text-primary: #0f172a;
      --text-secondary: #334155;
      --hover-bg: rgba(2,6,23,0.03);
      --active-link-bg: rgba(22,163,74,0.06);
      --active-link-text: #06202a;
      --shadow-color: rgba(2,6,23,0.06);
      --modal-overlay: rgba(2,6,23,0.45);
      --accent-1: #06b6d4;
      --accent-2: #0ea5a4;
      --transition-fast: .18s;
    }
    /* Dark theme overrides (darker / Discord-like) */
    [data-theme="dark"] {
      --bg-primary: #0b0d10; /* very dark background like Discord */
      --bg-card: #111217; /* darker card surface */
      --bg-sidebar: linear-gradient(180deg,#0d0f13,#07080a);
      --sidebar-border: rgba(255,255,255,0.02);
      --text-primary: #DCDDDE; /* near-white text similar to Discord */
      --text-secondary: #99A0AA; /* muted secondary */
      --hover-bg: rgba(255,255,255,0.02);
      --active-link-bg: rgba(88,101,242,0.06); /* subtle blurple */
      --active-link-text: #DCDDDE;
      --shadow-color: rgba(0,0,0,0.7);
      --modal-overlay: rgba(0,0,0,0.78);
      --accent-1: #5865f2; /* Discord-like blurple */
      --accent-2: #4752c4;
    }

    /* Base layout colors using variables */
    body { font-family: 'Poppins', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); }
    .main-content { background-color: var(--bg-primary); transition: background-color var(--transition-fast) ease, color var(--transition-fast) ease; }
    .card, .modal, .popup, .dropdown { background: var(--bg-card); color: var(--text-primary); border-radius: 0.75rem; box-shadow: 0 8px 20px var(--shadow-color); transition: background var(--transition-fast) ease, color var(--transition-fast) ease, box-shadow .22s ease; }
    .btn-primary { background-color: var(--accent-2); color: white; }
    .btn-secondary { background-color: rgba(255,255,255,0.04); color: var(--text-primary); }

    /* Sidebar/nav styles */
    .sidebar { background: var(--bg-sidebar); border-right: none; box-shadow: 8px 0 24px rgba(2,6,23,0.06); transition: width .25s ease, transform .25s, background .22s ease; position:relative; }
    .sidebar .logo-text h1 { letter-spacing: .2px; color: var(--text-primary); }
    a, a:link, a:visited { text-decoration: none !important; border-bottom: none !important; box-shadow: none !important; }
  .sidebar a { transition: transform calc(var(--transition-fast) * 1.1) cubic-bezier(.2,.9,.25,1), background .22s ease, color .18s ease; font-size:1.07rem; padding: .7rem 1rem; display:flex; align-items:center; gap:.75rem; border-radius:.75rem; color: var(--text-secondary); }
  /* larger icons for better visibility */
  .sidebar .material-icons { font-size:1.9rem; margin-right:.72rem; transition: transform .18s ease, color .18s ease; color: inherit; display:inline-block; line-height:1; }
  /* professional hover: subtle move, use app green for accents */
  .sidebar a:hover { transform: translateX(6px) scale(1.03); background: var(--active-link-bg); color: var(--text-primary); }
  .sidebar a:hover .material-icons { transform: translateX(3px) scale(1.10); color: var(--app-green); }

  /* make group-header inner links align like normal nav items */
  .group-header a { display:flex; align-items:center; justify-content:space-between; gap:.75rem; color: inherit; width:100%; padding: .55rem .9rem; }
  .group-header .material-icons { margin-right:.6rem; }
    .sidebar .group-header:hover { transform: translateX(4px); }
    .active-link { background: var(--active-link-bg); box-shadow: none; color: var(--active-link-text); border-left: none; font-weight: 600; }
    .nav-indicator { position: absolute; left: 6px; width:6px; height:44px; background: linear-gradient(180deg,var(--accent-1),var(--accent-2)); border-radius:6px; transition: top var(--transition-fast) cubic-bezier(.2,.9,.2,1), height .18s, opacity var(--transition-fast); opacity:0; z-index:40; }
    .nav-separator { width:4px; min-width:4px; display:flex; align-items:center; justify-content:center; background: transparent; }
    .nav-separator::before, .nav-separator::after { display: none !important; }

    /* submenu */
    .submenu { display: none; margin-left: 0; padding-left: 0; opacity:0; transform:translateY(-6px); }
    .submenu.open { display: block; opacity:1; transform:translateY(0); animation: submenuFadeIn .18s ease both; }
    @keyframes submenuFadeIn { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }
    .sidebar .submenu li a { display:flex; align-items:center; padding:8px 14px; border-radius:8px; color: var(--text-secondary); font-size:0.95rem; }
    .sidebar .submenu li a:hover { background: var(--hover-bg); color: var(--text-primary); }
    .sidebar .submenu li a { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    /* user and toggle */
    .theme-toggle { display:inline-block; margin-left:8px; }
    .theme-toggle input { display:none; }
    .toggle-slider { width:44px; height:24px; background: rgba(0,0,0,0.06); border-radius:999px; display:inline-block; position:relative; vertical-align:middle; transition: background .18s; }
    .toggle-slider::after { content: ''; width:18px; height:18px; background: white; border-radius:50%; position:absolute; left:3px; top:3px; transition: transform .18s ease; }
    [data-theme="dark"] .toggle-slider { background: linear-gradient(90deg,var(--accent-2),var(--accent-1)); }
    [data-theme="dark"] .toggle-slider::after { transform: translateX(20px); }

    /* modal / popup overlay helper */
    .modal-overlay { position: fixed; inset: 0; background: var(--modal-overlay); display:flex; align-items:center; justify-content:center; z-index:60; }
    .modal { max-width: 720px; padding: 20px; }

            /* Scoped green decorations for charges modal on mobile */
            @media (max-width:760px){
                  .charges-modal { background: transparent; box-shadow: none; }
                  .charges-modal:before{ content:''; position:absolute; inset:0; pointer-events:none; background: radial-gradient(circle at 15% 20%, rgba(22,163,74,0.10), transparent 12%), radial-gradient(circle at 90% 80%, rgba(5,150,105,0.06), transparent 18%); border-radius:16px; }
                  .charges-modal .modal-close{ border:1px solid rgba(22,163,74,0.06); }
                  .charges-modal .btn-primary{ background: linear-gradient(90deg,var(--app-green),var(--app-green-2)); }
            }

    /* small utilities */
    .pill-badge { background: linear-gradient(90deg,var(--accent-2),var(--accent-1)); color: white; padding:2px 8px; border-radius:999px; font-size:0.75rem; }
    /* Dark-mode force: make cards, widgets, tables, filters and inputs clearly visible */
    [data-theme="dark"] .card,
    [data-theme="dark"] .panel,
    [data-theme="dark"] .widget,
    [data-theme="dark"] .info-card,
    [data-theme="dark"] .white-card,
    [data-theme="dark"] .revenue-card,
    [data-theme="dark"] .dropdown,
    [data-theme="dark"] .modal,
    [data-theme="dark"] .popup,
    [data-theme="dark"] .table,
    [data-theme="dark"] .table thead,
    [data-theme="dark"] .table tbody,
    [data-theme="dark"] .filters,
    [data-theme="dark"] .search-bar,
    [data-theme="dark"] .filter-chip {
      background: rgba(255,255,255,0.02) !important;
      color: var(--text-primary) !important;
      border: 1px solid rgba(255,255,255,0.04) !important;
      box-shadow: 0 8px 24px rgba(0,0,0,0.5) !important;
    }
    /* Tables and rows */
    [data-theme="dark"] table, [data-theme="dark"] .table { background: transparent !important; color: var(--text-primary) !important; }
    [data-theme="dark"] .table thead th { color: var(--text-secondary) !important; background: transparent !important; border-bottom: 1px solid rgba(255,255,255,0.04); }
    [data-theme="dark"] .table tbody tr td { color: var(--text-primary) !important; border-bottom: 1px solid rgba(255,255,255,0.02); }
    /* Inputs / selects / search */
    [data-theme="dark"] input, [data-theme="dark"] textarea, [data-theme="dark"] select, [data-theme="dark"] .search-input {
      background: rgba(255,255,255,0.02) !important;
      color: var(--text-primary) !important;
      border: 1px solid rgba(255,255,255,0.04) !important;
      box-shadow: none !important;
    }
    /* Buttons in dark mode */
    [data-theme="dark"] .btn-secondary { background: transparent !important; color: var(--text-primary) !important; border: 1px solid rgba(255,255,255,0.04) !important; }
    [data-theme="dark"] .btn-primary { box-shadow: 0 6px 18px rgba(124,58,237,0.12); }
    /* Ensure titles, headings and small text are readable */
    [data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4, [data-theme="dark"] h5, [data-theme="dark"] p, [data-theme="dark"] span, [data-theme="dark"] a {
      color: var(--text-primary) !important;
    }
    /* Special: make any explicit white backgrounds darker (fallback) */
    [data-theme="dark"] [style*="background: #fff"], [data-theme="dark"] [style*="background: white"] {
      background: rgba(255,255,255,0.02) !important;
      color: var(--text-primary) !important;
    }
    /* Force common Tailwind white/gray and light color utilities to dark-friendly backgrounds */
    [data-theme="dark"] .bg-white,
    [data-theme="dark"] .bg-gray-50,
    [data-theme="dark"] .bg-gray-100,
    [data-theme="dark"] .bg-gray-200,
    [data-theme="dark"] .bg-gray-100\/50,
    [data-theme="dark"] .bg-white\/50,
    [data-theme="dark"] .bg-blue-50,
    [data-theme="dark"] .bg-pink-50,
    [data-theme="dark"] .bg-green-50,
    [data-theme="dark"] .bg-yellow-50,
    [data-theme="dark"] .bg-purple-100 {
      background: rgba(255,255,255,0.02) !important;
      color: var(--text-primary) !important;
      border: 1px solid rgba(255,255,255,0.04) !important;
      box-shadow: 0 8px 24px rgba(0,0,0,0.45) !important;
    }
    /* Override colored text utilities that are dark on light themes */
    [data-theme="dark"] .text-blue-700,
    [data-theme="dark"] .text-pink-600,
    [data-theme="dark"] .text-green-700,
    [data-theme="dark"] .text-amber-600,
    [data-theme="dark"] .text-purple-600,
    [data-theme="dark"] .text-black,
    [data-theme="dark"] .text-gray-900,
    [data-theme="dark"] .text-gray-800 {
      color: var(--text-primary) !important;
    }
    /* Map small utility text colors used across templates to readable dark-mode values */
    [data-theme="dark"] .text-gray-500, [data-theme="dark"] .text-gray-600, [data-theme="dark"] .text-gray-400 {
      color: var(--text-secondary) !important;
    }
    [data-theme="dark"] .text-red-600, [data-theme="dark"] .text-red-500 {
      color: #f87171 !important; /* visible red */
    }
    [data-theme="dark"] .text-green-700, [data-theme="dark"] .text-green-600 {
      color: #34d399 !important; /* visible green */
    }
    [data-theme="dark"] .text-amber-600, [data-theme="dark"] .text-amber-500 {
      color: #f59e0b !important; /* visible amber */
    }
    /* Neutralize common inline light-color usages in templates (labels, small text) */
    [data-theme="dark"] [style*="color:#6b7280"],
    [data-theme="dark"] [style*="color: #6b7280"] {
      color: var(--text-secondary) !important;
    }
    /* Make inline balance labels (amber) visible in dark mode */
    [data-theme="dark"] [style*="color:#92400e"],
    [data-theme="dark"] [style*="color: #92400e"] {
      color: #fb923c !important;
      font-weight:700 !important;
    }
    /* Convert small inline light-yellow banners to visible amber gradient in dark mode */
    [data-theme="dark"] [style*="background:#fff7ed"],
    [data-theme="dark"] [style*="background: #fff7ed"] {
      background: linear-gradient(90deg,#92400e,#fb923c) !important;
      color: #ffffff !important;
      border: none !important;
      box-shadow: 0 6px 18px rgba(146,64,14,0.12) !important;
    }
    /* Make the inscription remaining amount visible (use amber by default) */
    [data-theme="dark"] .inscription-remaining, [data-theme="dark"] .remaining-amount {
      color: #fb923c !important;
      font-weight:700 !important;
    }
    /* Ensure amounts are readable */
    [data-theme="dark"] .amount { color: var(--text-primary) !important; }
    /* Specific dashboard small tiles (apprenants) */
    [data-theme="dark"] .card .bg-blue-50,
    [data-theme="dark"] .card .bg-pink-50,
    [data-theme="dark"] .card .bg-green-50,
    [data-theme="dark"] .card .bg-yellow-50 {
      background: rgba(255,255,255,0.02) !important;
      color: var(--text-primary) !important;
    }
    [data-theme="dark"] .card .material-icons { color: var(--text-secondary) !important; filter: brightness(1.2); }
    [data-theme="dark"] .card .text-blue-700,
    [data-theme="dark"] .card .text-pink-600,
    [data-theme="dark"] .card .text-green-700,
    [data-theme="dark"] .card .text-amber-600 {
      color: var(--text-primary) !important;
    }
    /* Level bars and counts */
    [data-theme="dark"] .lvl-bar { background: rgba(255,255,255,0.03) !important; }
    [data-theme="dark"] .lvl-fill { box-shadow: none !important; }
    [data-theme="dark"] .level-name { color: var(--text-primary) !important; }
    [data-theme="dark"] .level-count { color: var(--text-secondary) !important; }
    /* Revenus card adjustments */
    [data-theme="dark"] .rev-card { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)) !important; }
    [data-theme="dark"] .rev-name { color: var(--text-primary) !important; }
    [data-theme="dark"] .rev-right, [data-theme="dark"] .rev-currency { color: var(--text-secondary) !important; }
    [data-theme="dark"] .rev-value { background: linear-gradient(90deg,var(--accent-1),var(--accent-2)) !important; }
    /* Recent avatars and list */
    [data-theme="dark"] .recent-avatar { background: rgba(255,255,255,0.03) !important; color: var(--text-primary) !important; }
    /* Replace explicit white inline background-color variants */
    [data-theme="dark"] [style*="background-color: #fff"],
    [data-theme="dark"] [style*="background-color:#fff"],
    [data-theme="dark"] [style*="background: #ffffff"],
    [data-theme="dark"] [style*="background:#ffffff"],
    [data-theme="dark"] [style*="background-color: white"] {
      background: rgba(255,255,255,0.02) !important;
      color: var(--text-primary) !important;
      border: 1px solid rgba(255,255,255,0.04) !important;
    }
    /* Ensure dark-mode text contrasts (override text-black / dark text utilities) */
    [data-theme="dark"] .text-black,
    [data-theme="dark"] .text-gray-900,
    [data-theme="dark"] .text-gray-800 {
      color: var(--text-primary) !important;
    }
    /* Specific small tiles inside cards (fallback generic selectors) */
    [data-theme="dark"] .card .small-tile,
    [data-theme="dark"] .card .stat-tile,
    [data-theme="dark"] .small-box,
    [data-theme="dark"] .tile {
      background: rgba(255,255,255,0.02) !important;
      color: var(--text-primary) !important;
      border: 1px solid rgba(255,255,255,0.04) !important;
      box-shadow: none !important;
    }

    /* Ensure generic badges and pills are readable in dark mode (keep semantic badges separate) */
    [data-theme="dark"] .badge,
    [data-theme="dark"] .pill,
    [data-theme="dark"] .statut-label,
    [data-theme="dark"] .level-count {
      background: rgba(255,255,255,0.03) !important;
      color: var(--text-primary) !important;
      border: 1px solid rgba(255,255,255,0.06) !important;
      box-shadow: none !important;
      padding: .25rem .6rem !important;
      border-radius: 999px !important;
      font-weight: 600 !important;
      font-size: 0.85rem !important;
    }

    /* Semantic badge colors in dark mode — keep strong contrast like in light theme */
    [data-theme="dark"] .badge-paid {
      background: linear-gradient(90deg,#065f46,#10b981) !important;
      color: #ffffff !important;
      border: none !important;
      padding: .35rem .7rem !important;
      box-shadow: 0 6px 14px rgba(6,95,70,0.12) !important;
    }
    [data-theme="dark"] .badge-partial {
      background: linear-gradient(90deg,#92400e,#fb923c) !important;
      color: #ffffff !important;
      border: none !important;
      padding: .35rem .7rem !important;
      box-shadow: 0 6px 14px rgba(146,64,14,0.10) !important;
    }
    [data-theme="dark"] .badge-due {
      background: linear-gradient(90deg,#7f1d1d,#ef4444) !important;
      color: #ffffff !important;
      border: none !important;
      padding: .35rem .7rem !important;
      box-shadow: 0 6px 14px rgba(127,29,29,0.12) !important;
    }

    /* Status classes used in students/enseignants/inscriptions */
    [data-theme="dark"] .status-actif,
    [data-theme="dark"] .status-inactif {
      padding: .35rem .7rem !important;
      border-radius: 999px !important;
      font-weight: 600 !important;
      font-size: 0.85rem !important;
      border: none !important;
    }
    [data-theme="dark"] .status-actif { background: linear-gradient(90deg,#065f46,#10b981) !important; color: #ffffff !important; }
    [data-theme="dark"] .status-inactif { background: linear-gradient(90deg,#7f1d1d,#ef4444) !important; color: #ffffff !important; }

    /* Balance / solde visual indicator (remaining fee) — match light-mode amber but increase contrast for dark bg */
    [data-theme="dark"] .balance-solde,
    [data-theme="dark"] .solde {
      background: linear-gradient(90deg,#92400e,#fb923c) !important;
      color: #ffffff !important;
      border: none !important;
      padding: .35rem .7rem !important;
      box-shadow: 0 6px 14px rgba(146,64,14,0.12) !important;
    }
    
      /* Force frais restant (remaining fees) to use app green so it matches light theme semantics but stays visible */
      [data-theme="dark"] .frais-restant,
      [data-theme="dark"] .remaining-amount,
      [data-theme="dark"] .remaining-green,
      [data-theme="dark"] .solde-positif,
      [data-theme="dark"] .balance-solde-positive {
        background: linear-gradient(90deg,var(--app-green),var(--app-green-2)) !important;
        color: #ffffff !important;
        border: none !important;
        padding: .35rem .6rem !important;
        font-weight:700 !important;
        box-shadow: 0 8px 20px rgba(6,95,70,0.12) !important;
      }
    
      /* Inscription status: ensure enrolled/inscrit badges are visible and prominent */
      [data-theme="dark"] .inscription-status,
      [data-theme="dark"] .inscription-badge,
      [data-theme="dark"] .status-inscrit,
      [data-theme="dark"] .status-enrolled,
      [data-theme="dark"] .statut-inscrit {
        padding: .32rem .65rem !important;
        border-radius: 999px !important;
        font-weight: 700 !important;
        font-size: 0.85rem !important;
        color: #ffffff !important;
        border: none !important;
        box-shadow: 0 8px 20px rgba(0,0,0,0.45) !important;
      }
      [data-theme="dark"] .inscription-status.inscrit, [data-theme="dark"] .status-inscrit.inscrit {
        background: linear-gradient(90deg,var(--app-green),var(--app-green-2)) !important;
      }
      [data-theme="dark"] .inscription-status.attente, [data-theme="dark"] .status-inscrit.attente, [data-theme="dark"] .inscription-badge.attente {
        background: linear-gradient(90deg,#92400e,#fb923c) !important; /* waiting / partial */
      }
      [data-theme="dark"] .inscription-status.annule, [data-theme="dark"] .status-inscrit.annule {
        background: linear-gradient(90deg,#7f1d1d,#ef4444) !important; /* cancelled */
      }
    
      /* Also neutralize some inline light-green backgrounds to use app green gradient */
      [data-theme="dark"] [style*="#dcfce7"],
      [data-theme="dark"] [style*="#bbf7d0"],
      [data-theme="dark"] [style*="#bbf7d0"] {
        background: linear-gradient(90deg,var(--app-green),var(--app-green-2)) !important;
        color: #ffffff !important;
        border: none !important;
      }

    /* Icon-only and action buttons (print, delete, solde, etc.) */
    [data-theme="dark"] .action-icon-btn,
    [data-theme="dark"] .icon-btn,
    [data-theme="dark"] .row-print-btn,
    [data-theme="dark"] .print-btn,
    [data-theme="dark"] .action-print,
    [data-theme="dark"] .print-option,
    [data-theme="dark"] .btn-white,
    [data-theme="dark"] .btn-secondary,
    [data-theme="dark"] .modal-action-btn.secondary,
    [data-theme="dark"] .modal-action-btn.primary,
    [data-theme="dark"] .modal-action-btn {
      background: rgba(255,255,255,0.02) !important;
      color: var(--text-primary) !important;
      border: 1px solid rgba(255,255,255,0.06) !important;
      box-shadow: none !important;
    }

    /* Danger / Supprimer buttons should keep a subtle red tint but remain readable */
    [data-theme="dark"] .btn-danger,
    [data-theme="dark"] .delete-btn,
    [data-theme="dark"] .action-delete {
      background: linear-gradient(90deg, rgba(239,68,68,0.12), rgba(239,68,68,0.06)) !important;
      color: #fff5f5 !important;
      border: 1px solid rgba(239,68,68,0.18) !important;
      box-shadow: none !important;
    }

    /* Ensure material icons inside action buttons are visible */
    [data-theme="dark"] .action-icon-btn .material-icons,
    [data-theme="dark"] .icon-btn .material-icons,
    [data-theme="dark"] .row-print-btn .material-icons,
    [data-theme="dark"] .delete-btn .material-icons,
    [data-theme="dark"] .action-print .material-icons {
      color: var(--text-primary) !important;
      filter: brightness(1.05) !important;
    }

    /* Map utility text-white to readable color in dark mode (templates may use this) */
    [data-theme="dark"] .text-white {
      color: var(--text-primary) !important;
    }
    /* Strong modal/popup contrast and readable controls in dark mode */
    [data-theme="dark"] .modal-overlay { background: rgba(1,2,6,0.86) !important; backdrop-filter: none !important; }
    [data-theme="dark"] .modal { max-width: 820px; padding: 28px !important; border-radius: 12px !important; background: linear-gradient(180deg, rgba(255,255,255,0.045), rgba(255,255,255,0.025)) !important; border: 1px solid rgba(255,255,255,0.08) !important; box-shadow: 0 40px 120px rgba(0,0,0,0.8) !important; z-index: 10001 !important; }
    [data-theme="dark"] .modal .modal-header { border-bottom: 1px solid rgba(255,255,255,0.04) !important; padding-bottom: 12px !important; margin-bottom: 14px !important; }
    [data-theme="dark"] .modal .modal-title { color: var(--text-primary) !important; font-weight:700 !important; font-size:1.15rem !important; }
    [data-theme="dark"] .modal .modal-body { color: var(--text-secondary) !important; max-height: 65vh; overflow:auto; padding-right: 8px !important; }
    [data-theme="dark"] .modal .modal-footer { border-top: 1px solid rgba(255,255,255,0.03) !important; padding-top: 12px !important; margin-top: 14px !important; display:flex; gap:8px; justify-content:flex-end; }

    /* Inputs / selects inside modals: make fields darker and text readable */
    [data-theme="dark"] .modal input, [data-theme="dark"] .modal textarea, [data-theme="dark"] .modal select, [data-theme="dark"] .modal .form-control {
      background: rgba(0,0,0,0.22) !important; /* subtle dark field */
      color: var(--text-primary) !important;
      border: 1px solid rgba(255,255,255,0.06) !important;
      box-shadow: none !important;
      padding: .5rem .7rem !important;
    }
    [data-theme="dark"] .modal input::placeholder, [data-theme="dark"] .modal textarea::placeholder { color: rgba(230,238,248,0.6) !important; }
    [data-theme="dark"] .modal label, [data-theme="dark"] .modal .label { color: var(--text-primary) !important; font-weight:600 !important; }

    /* Make modal close button / small icons visible */
    [data-theme="dark"] .modal .close-btn, [data-theme="dark"] .modal .btn-close, [data-theme="dark"] .modal .material-icons.close {
      background: rgba(255,255,255,0.03) !important; color: var(--text-primary) !important; border: 1px solid rgba(255,255,255,0.06) !important; box-shadow: none !important;
    }

    /* Scrollbar inside modal body */
    [data-theme="dark"] .modal .modal-body::-webkit-scrollbar { width: 12px; }
    [data-theme="dark"] .modal .modal-body::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); border-radius: 8px; }
    [data-theme="dark"] .modal .modal-body::-webkit-scrollbar-thumb { background: linear-gradient(180deg, rgba(124,58,237,0.22), rgba(6,182,212,0.12)); border-radius: 8px; border: 2px solid rgba(0,0,0,0.12); }

    /* Ensure small help/muted text in modals is visible (no collapse into background) */
    [data-theme="dark"] .modal small, [data-theme="dark"] .modal .muted, [data-theme="dark"] .modal .help-text { color: var(--text-secondary) !important; opacity: 1 !important; }

    /* If any inline translucent white is present in modals, strengthen it */
    [data-theme="dark"] .modal [style*="background: rgba(255,255,255,0.02)"],
    [data-theme="dark"] .modal [style*="background: rgba(255,255,255,0.03)"] {
      background: rgba(255,255,255,0.045) !important; color: var(--text-primary) !important;
    }
    /* ==================== Additional fixes for visibility in dark mode ==================== */
    /* Make modals/popups the visually dominant elements */
    [data-theme="dark"] .modal-overlay {
      background: rgba(0,0,0,0.90) !important; /* strongest dark backdrop to contrast popups */
      backdrop-filter: none !important; -webkit-backdrop-filter: none !important;
      z-index: 9998 !important;
    }
    /* Defensive: ensure any modal-backdrop used in templates is also non-blurring */
    [data-theme="dark"] .modal-backdrop, [data-theme="dark"] .modal-backdrop * {
      backdrop-filter: none !important; -webkit-backdrop-filter: none !important; filter: none !important;
    }
    [data-theme="dark"] .modal, [data-theme="dark"] .popup {
      /* Force opaque/darker modal surface to prevent background bleed-through */
      background: rgba(10,10,12,0.98) !important;
      color: var(--text-primary) !important;
      box-shadow: 0 30px 80px rgba(0,0,0,0.75) !important;
      border: 1px solid rgba(255,255,255,0.06) !important;
      z-index: 9999 !important;
      transform: translateZ(0); /* avoid blending with background */
    }
    /* Also ensure modal inner cards/panels are opaque */
    [data-theme="dark"] .modal .bg-white, [data-theme="dark"] .modal-card, [data-theme="dark"] .modal > div, [data-theme="dark"] .modal * {
      background: rgba(10,10,12,0.98) !important;
      color: var(--text-primary) !important;
    }
    /* Also cover cases where the inner popup doesn't use the .modal class but is placed inside .modal-backdrop (many templates use bg-white on the inner panel) */
    [data-theme="dark"] .modal-backdrop .bg-white,
    [data-theme="dark"] .modal-backdrop > div,
    [data-theme="dark"] .modal-backdrop div,
    [data-theme="dark"] .modal-backdrop form {
      background: rgba(10,10,12,0.98) !important;
      color: var(--text-primary) !important;
      border: 1px solid rgba(255,255,255,0.04) !important;
      box-shadow: 0 30px 80px rgba(0,0,0,0.75) !important;
    }
    [data-theme="dark"] .modal h1, [data-theme="dark"] .modal h2, [data-theme="dark"] .modal h3, [data-theme="dark"] .modal label, [data-theme="dark"] .modal p {
      color: var(--text-primary) !important;
    }
    [data-theme="dark"] .modal .btn-primary, [data-theme="dark"] .popup .btn-primary {
      background: linear-gradient(90deg,var(--accent-2),var(--accent-1)) !important;
      color: #fff !important;
      box-shadow: 0 8px 30px rgba(124,58,237,0.18) !important;
    }

    /* Ensure modal action text/icons are visible */
    [data-theme="dark"] .modal .material-icons, [data-theme="dark"] .popup .material-icons {
      color: var(--text-primary) !important; filter: brightness(1.1) !important;
    }

    /* Important: stronger status mappings for any variant names used across templates */
    [data-theme="dark"] .status-actif, [data-theme="dark"] .status-active, [data-theme="dark"] .is-active, [data-theme="dark"] .statut-actif, [data-theme="dark"] .badge-success {
      background: linear-gradient(90deg,#065f46,#10b981) !important; color: #ffffff !important; border: none !important; box-shadow: 0 8px 20px rgba(6,95,70,0.12) !important;
    }
    [data-theme="dark"] .status-inactif, [data-theme="dark"] .status-inactive, [data-theme="dark"] .badge-failed, [data-theme="dark"] .badge-danger {
      background: linear-gradient(90deg,#7f1d1d,#ef4444) !important; color: #ffffff !important; border: none !important; box-shadow: 0 8px 20px rgba(127,29,29,0.12) !important;
    }

    /* ======================================================================= */
    /* Ensure frais restant (remaining fees) use clear semantic colors in dark */
    /* Positive balances (overpaid / credit) -> green (value < 0 or credited) */
    [data-theme="dark"] .balance-credite, /* produced when value < 0 */
    [data-theme="dark"] .solde-positif,
    [data-theme="dark"] .remaining-amount.positive,
    [data-theme="dark"] .remaining-green {
      background: linear-gradient(90deg,#065f46,#10b981) !important;
      color: #ffffff !important;
      border: none !important;
      padding: .35rem .6rem !important;
      font-weight:700 !important;
      box-shadow: 0 8px 20px rgba(6,95,70,0.14) !important;
    }

    /* Negative balances (student owes) -> use amber same as light theme (value > 0) */
    [data-theme="dark"] .balance-solde, /* produced when value > 0 */
    [data-theme="dark"] .solde-negatif,
    [data-theme="dark"] .remaining-amount.negative {
      background: linear-gradient(90deg,#92400e,#fb923c) !important;
      color: #ffffff !important;
      border: none !important;
      padding: .35rem .6rem !important;
      font-weight:700 !important;
      box-shadow: 0 8px 20px rgba(146,64,14,0.14) !important;
    }

    /* Neutral / réglé */
    [data-theme="dark"] .balance-regle, [data-theme="dark"] .balance-regle span {
      background: rgba(255,255,255,0.03) !important;
      color: var(--text-secondary) !important;
      border: 1px solid rgba(255,255,255,0.04) !important;
      padding: .25rem .5rem !important;
      font-weight:700 !important;
    }

    /* Make inscription status badges as prominent as student status badges (parity) */
    [data-theme="dark"] .status-inscrit, [data-theme="dark"] .status-actif, [data-theme="dark"] .statut-inscrit, [data-theme="dark"] .inscription-status {
      background: linear-gradient(90deg,#065f46,#10b981) !important;
      color: #ffffff !important;
      border: none !important;
      box-shadow: 0 8px 20px rgba(6,95,70,0.12) !important;
      padding: .32rem .65rem !important;
      border-radius: 999px !important;
      font-weight:700 !important;
      font-size: 0.85rem !important;
    }
    [data-theme="dark"] .status-autre, [data-theme="dark"] .status-inactif, [data-theme="dark"] .status-autre, [data-theme="dark"] .status-annule {
      background: linear-gradient(90deg,#7f1d1d,#ef4444) !important;
      color: #ffffff !important;
      border: none !important;
      box-shadow: 0 8px 20px rgba(127,29,29,0.12) !important;
      padding: .32rem .65rem !important;
      border-radius: 999px !important;
      font-weight:700 !important;
      font-size: 0.85rem !important;
    }

    /* Remaining fee / solde: ensure credited amounts are green and owed amounts are red */
    [data-theme="dark"] .remaining-amount, [data-theme="dark"] .remaining-green, [data-theme="dark"] .solde-positif, [data-theme="dark"] .balance-credite, [data-theme="dark"] .solde {
      /* default: prefer green for credited amounts when class is balance-credite; owed items use balance-solde (red) */
      background: linear-gradient(90deg,#065f46,#10b981) !important;
      color: #ffffff !important;
      border: none !important;
      padding: .35rem .6rem !important;
      font-weight:700 !important;
      box-shadow: 0 8px 20px rgba(6,95,70,0.12) !important;
    }

    /* Neutralize common pale-light-green inline colors (tailwind/light theme greens) so they become strong in dark mode */
    [data-theme="dark"] [style*="#ecfdf5"],
    [data-theme="dark"] [style*="#dcfce7"],
    [data-theme="dark"] [style*="#bbf7d0"],
    [data-theme="dark"] [style*="#10b981"],
    [data-theme="dark"] [style*="#16a34a"],
    [data-theme="dark"] [style*="#059669"] {
      background: linear-gradient(90deg,#065f46,#10b981) !important;
      color: #ffffff !important;
      border: none !important;
      box-shadow: 0 6px 18px rgba(6,95,70,0.10) !important;
    }

    /* Ensure pop-up close / action buttons remain visible */
    [data-theme="dark"] .modal .btn-secondary, [data-theme="dark"] .modal .btn-white {
      background: rgba(255,255,255,0.03) !important; color: var(--text-primary) !important; border: 1px solid rgba(255,255,255,0.06) !important;
    }

    /* Reduce chance of modal text collapsing into background: increase contrast on small text */
    [data-theme="dark"] .modal small, [data-theme="dark"] .modal .muted, [data-theme="dark"] .popup small, [data-theme="dark"] .popup .muted {
      color: var(--text-secondary) !important; opacity: 1 !important;
    }
    /* ======================================================================================= */
  </style>
</head>
<body class="flex h-screen">
  <aside class="w-64 sidebar flex flex-col p-4">
    <div class="flex items-center mb-10">
      <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center text-white text-lg font-bold mr-3">GS</div>
      <div class="logo-text">
        <h1 class="text-xl font-bold">GénieSchool</h1>
        <p class="text-sm">Excellence en Formation</p>
      </div>
    </div>
  <!-- Animated nav indicator (moves to hovered/active link) -->
  <div id="navIndicator" class="nav-indicator" aria-hidden="true"></div>
    <nav class="flex-grow">
      
      
  
  
      
      
  
      
  
      
  
      
      
      
      <ul>
        <li class="mb-4">
          <a href="/" class="flex items-center px-4 py-2 rounded-lg active-link">
            <span class="material-icons mr-3">dashboard</span> Tableau de bord
          </a>
        </li>
        <li class="mb-4">
          <div class="group-header px-4 py-2 rounded-lg flex items-center justify-between ">
            <div class="flex items-center">
              <span class="material-icons mr-3">people</span>
              <span>Étudiants</span>
            </div>
            <span class="material-icons text-gray-400">expand_more</span>
          </div>
          <ul class="mt-2 submenu ">
            <li class="mb-2">
              <a href="/etudiants/" class="">
                <span class="material-icons mr-3 text-sm" style="vertical-align:middle;">people</span>
                <span>Liste des étudiants</span>
              </a>
            </li>
            <li>
              <a href="/inscriptions/" class="">
                <span class="material-icons mr-3 text-sm" style="vertical-align:middle;">how_to_reg</span>
                <span>Liste des inscriptions</span>
              </a>
            </li>
          </ul>
        </li>
        <li class="mb-4">
          <a href="/enseignants/" class="flex items-center px-4 py-2 rounded-lg ">
            <span class="material-icons mr-3">supervisor_account</span> Enseignant
          </a>
        </li>
        <li class="mb-4">
          <a href="/formations/" class="flex items-center px-4 py-2 rounded-lg ">
            <span class="material-icons mr-3">school</span> Formations
          </a>
        </li>
        <li class="mb-4">
          <a href="/planning/" class="flex items-center px-4 py-2 rounded-lg ">
            <span class="material-icons mr-3">event</span> Planning
          </a>
        </li>
        <li class="mb-4">
          <a href="/presence/" class="flex items-center px-4 py-2 rounded-lg ">
            <span class="material-icons mr-3">visibility</span> Présence
          </a>
        </li>
        <li class="mb-4">
          <a href="/examens/" class="flex items-center px-4 py-2 rounded-lg ">
            <span class="material-icons mr-3">assignment</span> Examens
          </a>
        </li>
        
        <li class="mb-4">
          <div class="group-header">
            <a href="/finances/" class="flex items-center px-4 py-2 rounded-lg justify-between ">
              <div class="flex items-center">
                <span class="material-icons mr-3">payments</span>
                <span>Finances</span>
              </div>
              <span class="material-icons text-gray-400">expand_more</span>
            </a>
          </div>
          <ul class="mt-2 submenu ">
            
            <li class="mb-2">
              <a href="/reglements/fournisseurs/" class="">
                <span class="material-icons mr-3 text-sm" style="vertical-align:middle;">storefront</span>
                <span>Fournisseurs</span>
              </a>
            </li>
            <li>
              <a href="#">
                <span class="material-icons mr-3 text-sm" style="vertical-align:middle;">savings</span>
                <span>Trésor</span>
              </a>
            </li>
          </ul>
        </li>
        <li class="mb-4">
          <a href="/parametres/" class="flex items-center px-4 py-2 rounded-lg ">
            <span class="material-icons mr-3">settings</span> Paramètres
          </a>
        </li>
        <li>
          <a href="/rapports/" class="flex items-center px-4 py-2 rounded-lg ">
            <span class="material-icons mr-3">bar_chart</span> Rapports
          </a>
        </li>
      </ul>
    </nav>
    <div class="mt-auto">
      <div class="mt-4 flex items-center justify-between">
        <span class="material-icons dark-mode-icon" id="themeIcon">dark_mode</span>
        <label class="theme-toggle">
          <input type="checkbox" id="themeToggle"/>
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="flex items-center">
        <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-gray-600 font-bold mr-3">H</div>
        <div class="user-info">
          <p class="font-semibold">HAMZA</p>
          <p class="text-sm">Administrateur</p>
        </div>
      </div>
    </div>
  </aside>
  <!-- modern visual separator between sidebar and content -->
  <div class="nav-separator" aria-hidden="true"></div>
  <main class="flex-1 p-8 overflow-y-auto main-content" style="margin-left:0;">
    

<header class="flex justify-between items-center mb-8">
<h1 class="text-4xl md:text-5xl font-bold header-text">Tableau de Bord</h1>
<!-- Decorative 3D header area (fills the space between title and stats) -->
<div class="header-deco" aria-hidden="true">
      <svg width="100%" height="56" viewBox="0 0 800 56" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
            <defs>
                  <filter id="b" x="-20%" y="-20%" width="140%" height="140%"><feGaussianBlur stdDeviation="18" result="blur"/></filter>
            </defs>
            <!-- soft layered blobs for subtle 3D depth -->
            <g filter="url(#b)">
                  <ellipse cx="220" cy="28" rx="140" ry="22" fill="#c7f9e6" opacity="0.35"/>
                  <ellipse cx="380" cy="20" rx="120" ry="20" fill="#e9d5ff" opacity="0.30"/>
                  <ellipse cx="540" cy="30" rx="160" ry="24" fill="#dbeafe" opacity="0.28"/>
            </g>
            <!-- faint grid/lines for a subtle 3D plane -->
            <g opacity="0.06" stroke="#000" stroke-width="0.6">
                  <path d="M0 50 L800 10"/>
                  <path d="M0 40 L800 0"/>
            </g>
      </svg>
</div>
<div class="flex space-x-6 header-stats" role="list">
      <div class="header-stat p-2 text-center" role="listitem">
            <p class="text-3xl md:text-4xl font-extrabold stat-num stat-num-blue" data-value="29">0</p>
            <p class="text-xs stat-label">Étudiants</p>
      </div>
      <div class="header-stat p-2 text-center" role="listitem">
            <p class="text-3xl md:text-4xl font-extrabold stat-num stat-num-green" data-value="10">0</p>
            <p class="text-xs stat-label">Formations</p>
      </div>
      <div class="header-stat p-2 text-center" role="listitem">
            <p class="text-3xl md:text-4xl font-extrabold stat-num stat-num-purple" data-value="2">0</p>
            <p class="text-xs stat-label">Utilisateurs</p>
      </div>
</div>
</header>

<section>
<h2 class="text-xl font-semibold section-title mb-4">Gestion des Formations</h2>
<div class="w-full mx-auto px-0 max-w-full">
<style>
/* Make top cards stretch to the same height and ensure bar fills align */
.top-cards-grid { grid-auto-rows: 1fr; }
.top-cards-grid .card { height: 100%; display: flex; flex-direction: column; justify-content: space-between; }
.form-bar, .inv-bar, .lvl-fill { transition: width .8s ease; height: .75rem; border-radius: 9999px; display: block; }
.lvl-fill { height: 100%; }
/* Slightly larger text inside top cards to occupy more top space */
.top-cards-grid .card { padding-top: 1.5rem; padding-bottom: 1.5rem; padding-left: 1rem; padding-right: 1rem; }
.header-deco { flex:1 1 auto; margin:0 8px 0 0; height:56px; display:block; position:relative; max-width:420px; }
.header-deco svg { width:100%; height:100%; display:block; }
.header-deco { pointer-events:none; opacity:0.95; }
/* Small variant for occ-track when used in compact cards (payments) */
.occ-track.small { height:10px; }
.top-cards-grid .card h3 { font-size: 1.125rem; }
.top-cards-grid .card .text-2xl { font-size: 1.875rem; }
.top-cards-grid .card .material-icons { font-size: 2.25rem; }
/* formation list - larger labels */
.form-row .formation-name { font-size: 1rem; font-weight: 700; color: #111827; }
.form-row .formation-count { font-size: 0.95rem; color: #374151; }
/* Group occupation visual and decorative icon */
.occupation-visual { margin-top: 10px; }
.occ-track { background: #f1f5f9; height: 14px; border-radius: 9999px; overflow: hidden; }
.occ-fill { height: 100%; width: 0; background: linear-gradient(90deg, #16a34a, #06b6d4); transition: width 1.0s ease; }
.occ-meta { display:flex; justify-content:space-between; align-items:center; margin-top:8px; }
.occ-label { font-size: 0.875rem; color:#475569; }
.occ-pct { font-weight:700; color:#0f172a; }
.icon-deco { position: absolute; top:10px; right:12px; width:40px; height:40px; opacity:0.12; pointer-events:none; }
.card { position: relative; }
/* Header stat styles */
.stat-num { font-variant-numeric: tabular-nums; }
.stat-num-blue { color: #1d4ed8; } /* Tailwind blue-700, matches Garçons */
.stat-num-green { color: #db2777; } /* Tailwind pink-600, matches Filles */
.stat-num-purple { color: #15803d; } /* Tailwind green-700, matches Étudiants */
.stat-label { color: rgba(15,23,42,0.55); margin-top:4px }
</style>
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-4 top-cards-grid">
      <!-- Row 1: Students / Formation distribution / New / Certifications -->
      <div class="card p-6 bg-white shadow-sm border border-gray-100 rounded-lg">
            <h3 class="text-lg font-semibold mb-2">Aprennants</h3>
            <p class="text-sm text-gray-600 mb-4">Total: <span class="font-bold">16</span></p>
            <!-- four quick stats: Garçons / Filles / Etudiants / Fonctionnaires -->
            <div class="grid grid-cols-2 gap-3 mb-3" style="width:100%;">
                  <div class="flex items-center space-x-3 bg-blue-50 p-3 rounded-lg">
                        <span class="material-icons text-blue-600 text-3xl">person</span>
                        <div class="text-left">
                              <p class="text-2xl font-bold text-blue-700">2</p>
                              <p class="text-xs text-gray-500">Garçons</p>
                        </div>
                  </div>
                  <div class="flex items-center space-x-3 bg-pink-50 p-3 rounded-lg">
                        <span class="material-icons text-pink-600 text-3xl">person</span>
                        <div class="text-left"> 
                              <p class="text-2xl font-bold text-pink-600">1</p>
                              <p class="text-xs text-gray-500">Filles</p>
                        </div>
                  </div>
                  <div class="flex items-center space-x-3 bg-green-50 p-3 rounded-lg">
                        <span class="material-icons text-green-600 text-3xl">school</span>
                        <div class="text-left">
                              <p class="text-2xl font-bold text-green-700">0</p>
                              <p class="text-xs text-gray-500">Étudiants</p>
                        </div>
                  </div>
                  <div class="flex items-center space-x-3 bg-yellow-50 p-3 rounded-lg" style="flex:1;">
                        <span class="material-icons text-amber-600 text-3xl">work</span>
                        <div class="text-left">
                              <p class="text-2xl font-bold text-amber-600">2</p>
                              <p class="text-xs text-gray-500">Fonctionnaires</p>
                        </div>
                  </div>
            </div>
            <!-- removed small formation list as requested -->
      </div>

      <div class="card p-6 bg-white shadow-sm border border-gray-100 rounded-lg">
            <h3 class="text-lg font-semibold mb-2">Répartition par formation (détail)</h3>
            <div class="space-y-2">
                              
                                    <div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                                          
                                          
                                                <span class="form-bar" data-pct="42%" style="width:0; background:#84cc16; display:block; height:100%; border-radius:9999px;"></span>
                                          
                                    </div>
                                    <div class="flex justify-between form-row"><span class="formation-name">Mathématiques Appliquées</span><span class="formation-count">12 (42%)</span></div>
                  
                                    <div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                                          
                                          
                                                <span class="form-bar" data-pct="14%" style="width:0; background:#f59e0b; display:block; height:100%; border-radius:9999px;"></span>
                                          
                                    </div>
                                    <div class="flex justify-between form-row"><span class="formation-name">Design Web</span><span class="formation-count">4 (14%)</span></div>
                  
                                    <div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                                          
                                          
                                                <span class="form-bar" data-pct="10%" style="width:0; background:#f59e0b; display:block; height:100%; border-radius:9999px;"></span>
                                          
                                    </div>
                                    <div class="flex justify-between form-row"><span class="formation-name">Informatique</span><span class="formation-count">3 (10%)</span></div>
                  
                                    <div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                                          
                                          
                                                <span class="form-bar" data-pct="10%" style="width:0; background:#f59e0b; display:block; height:100%; border-radius:9999px;"></span>
                                          
                                    </div>
                                    <div class="flex justify-between form-row"><span class="formation-name">Gestion &amp; Finance</span><span class="formation-count">3 (10%)</span></div>
                  
                                    <div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                                          
                                          
                                                <span class="form-bar" data-pct="10%" style="width:0; background:#f59e0b; display:block; height:100%; border-radius:9999px;"></span>
                                          
                                    </div>
                                    <div class="flex justify-between form-row"><span class="formation-name">Resauxxw</span><span class="formation-count">3 (10%)</span></div>
                  
                                    <div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                                          
                                          
                                                <span class="form-bar" data-pct="7%" style="width:0; background:#f59e0b; display:block; height:100%; border-radius:9999px;"></span>
                                          
                                    </div>
                                    <div class="flex justify-between form-row"><span class="formation-name">Marketing Digital</span><span class="formation-count">2 (7%)</span></div>
                  
            </div>
      </div>

        <div class="card p-6 bg-white shadow-sm border border-gray-100 rounded-lg">
                  <h3 class="text-lg font-semibold mb-2">Nouveaux ce mois-ci</h3>
                  <p class="text-2xl font-bold">8</p>
                  <p class="text-sm text-gray-500 mt-2 mb-3">Étudiants inscrits depuis le début du mois</p>
                  <!-- Clean recent students auto-scroll (name + ID) -->
                  <style>
                  .scroll-list { height: 120px; overflow: hidden; position: relative; }
                  .scroll-list ul { margin:0; padding:0; list-style:none; }
                  .scroll-list li { padding: 8px 0; border-bottom: 1px solid #f3f4f6; display:flex; justify-content:space-between; }
                  .scroll-list ul.animate { animation-name: scrollUp; animation-timing-function: linear; animation-iteration-count: infinite; will-change: transform; }
                  .scroll-list:hover ul.animate { animation-play-state: paused; }
                  @keyframes scrollUp { 0% { transform: translateY(0); } 100% { transform: translateY(-50%); } }
                  </style>
                  <div class="scroll-list" id="recent-scroll">
                          <ul id="recent-list">
                                    <!-- JS will populate recent students here -->
                          </ul>
                  </div>
                  <style>
                  /* Avatar styles for recent students */
                  .recent-item { display:flex; align-items:center; gap:10px; padding:10px 0; border-bottom:1px solid #f3f4f6; }
                  .recent-avatar { width:56px; height:56px; border-radius:9999px; flex:0 0 56px; overflow:hidden; display:inline-flex; align-items:center; justify-content:center; background:#eef2ff; color:#111827; font-weight:700; font-size:18px; }
                  .recent-avatar img { width:100%; height:100%; object-fit:cover; display:block; }
                  .recent-meta { flex:1; display:flex; flex-direction:column; }
                  .recent-name { font-size:14px; font-weight:700; color:#111827; }
                  .recent-sub { font-size:12px; color:#6b7280; }
                  /* scrolling: ensure a smooth continuous vertical scroll */
                  .scroll-list { height: 220px; overflow: hidden; position: relative; }
                  .scroll-list ul { margin:0; padding:0; list-style:none; }
                  .scroll-list ul.animate { animation-name: scrollUp; animation-timing-function: linear; animation-iteration-count: infinite; will-change: transform; }
                  .scroll-list:hover ul.animate { animation-play-state: paused; }
                  @keyframes scrollUp { 0% { transform: translateY(0); } 100% { transform: translateY(-50%); } }
                  </style>
                  <script>
                  (function(){
                        const url = '/api/dashboard/stats/';
                        function initials(name, surname){
                              const n = (name||'').trim();
                              const p = (surname||'').trim();
                              const a = n.charAt(0) || '';
                              const b = p.charAt(0) || '';
                              return (a + b).toUpperCase() || (n.charAt(0)||'').toUpperCase();
                        }
                        async function loadRecent(){
                              try{
                                    const res = await fetch(url);
                                    if(!res.ok){ console.warn('dashboard stats fetch failed', res.status); return; }
                                    const data = await res.json();
                                    const students = data.recent_etudiants || [];
                                    const list = document.getElementById('recent-list');
                                    list.innerHTML = '';
                                    if(students.length === 0){
                                          list.innerHTML = '<li class="text-gray-500">Aucun étudiant récent</li>';
                                          return;
                                    }
                                    // Build HTML for items using avatar image or initials fallback
                                    const itemHtml = students.map(s => {
                                          const photo = s.photo || '';
                                          const name = (s.nom||'') + ' ' + (s.prenom||'');
                                          const lvl = s.niveau_etude || '';
                                          // avatar element: if photo available use <img>, otherwise show initials span
                                          const avatar = photo ? `<span class="recent-avatar"><img src="${photo}" alt="${name}" onerror="this.style.display='none'; this.parentNode.classList.add('initials')"></span>` : `<span class="recent-avatar initials">${initials(s.nom, s.prenom)}</span>`;
                                          // include data-id and role for accessibility
                                          return `<li class="recent-item" data-id="${s.id}" role="button" tabindex="0"><span class="avatar-wrap">${avatar}</span><div class="recent-meta"><span class="recent-name">${name}</span><span class="recent-sub">${lvl ? lvl+' • ' : ''}ID:${s.id}</span></div></li>`;
                                    }).join('');
                                    // duplicate items for continuous scroll
                                    let fullHtml = itemHtml + itemHtml;
                                    // if only one item, repeat several times to create movement
                                    if(students.length === 1){ fullHtml = itemHtml.repeat(6); }
                                    list.innerHTML = fullHtml;
                                    // compute animation duration: ~3s per original item, clamp between 8s and 40s
                                    const duration = Math.min(Math.max(students.length * 3, 8), 40);
                                    list.style.animationDuration = duration + 's';
                                    // trigger animation on UL
                                    list.classList.add('animate');
                                    // after rendering, attach hover and click handlers (event delegation)
                                    try{ if(typeof setupRecentInteractions === 'function') setupRecentInteractions(); }catch(e){}
                              }catch(e){ console.warn('recent students load failed', e); }
                        }
                        if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', loadRecent);
                        else loadRecent();
                  })();
                  </script>
                  <style>
                  /* Hover enlarge effect for recent items */
                  .recent-item { transition: transform .18s cubic-bezier(.2,.9,.25,1), box-shadow .18s ease; cursor: pointer; }
                  .recent-item:hover, .recent-item:focus { transform: translateY(-6px) scale(1.04); box-shadow: 0 18px 40px rgba(2,6,23,0.08); z-index: 6; }
                  .recent-item .recent-avatar { transition: transform .18s ease, box-shadow .18s ease; }
                  .recent-item:hover .recent-avatar, .recent-item:focus .recent-avatar { transform: scale(1.08); box-shadow: 0 8px 24px rgba(2,6,23,0.06); }
                  /* Modal backdrop tweaks to match base modal styling */
                  #recentVerifyModal.modal-overlay { align-items: center; justify-content: center; }
                  #recentVerifyModal .modal { max-width:720px; width: calc(100% - 48px); }
                  </style>

                                                      <!-- Full verification modal (reused from etudiants.html) -->
                                                      <script>
                                                      // small helper to read CSRF cookie
                                                      function getCookie(name){ const v=document.cookie.match('(^|;) ?'+name+'=([^;]*)(;|$)'); return v? decodeURIComponent(v[2]) : null; }
                                                      const csrftoken = getCookie('csrftoken');

                                                      // create modal element (identical to etudiants.html verify modal)
                                                      const verifyModal = document.createElement('div');
                                                      verifyModal.id = 'verifyModal';
                                                      verifyModal.className = 'hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop';
                                                      verifyModal.innerHTML = `
                  <div class="bg-white rounded-lg shadow-lg w-11/12 max-w-4xl p-6" style="max-height:88vh;overflow:auto;">
                        <div style="position:sticky;top:0;z-index:60;background:#fff;padding:10px 12px;border-bottom:1px solid #eef2f7;margin-bottom:12px;">
                              <div id="verifyProgress" style="display:flex;gap:12px;margin:0;padding:0 6px;align-items:center;width:100%;justify-content:space-between;"> <!-- steps inserted here --> </div>
                        </div>
                        <div class="flex justify-between items-center mb-2" style="margin-top:8px;">
                              <h3 class="text-lg font-semibold">Fiche vérification</h3>
                              <div class="verify-top-actions">
                                    <button id="verifyCancelTop" class="btn-secondary">Annuler</button>
                                    <button id="closeVerify" class="icon-btn">✕</button>
                              </div>
                        </div>
                        <div id="verifyContent" style="padding-top:8px;">
                              <div style="display:flex;gap:20px;align-items:flex-start;">
                                    <div style="flex:1; display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px;">
                                          <div style="">
                                                <div style="font-size:12px;color:#6b7280;font-weight:700;">Nom</div>
                                                <div id="v_nom" style="font-size:14px;color:#111827;font-weight:600;"></div>
                                          </div>
                                          <div>
                                                <div style="font-size:12px;color:#6b7280;font-weight:700;">Prénom</div>
                                                <div id="v_prenom" style="font-size:14px;color:#111827;font-weight:600;"></div>
                                          </div>
                                          <div>
                                                <div style="font-size:12px;color:#6b7280;font-weight:700;">Sexe</div>
                                                <div id="v_sexe" style="font-size:14px;color:#111827;"></div>
                                          </div>
                                          <div>
                                                <div style="font-size:12px;color:#6b7280;font-weight:700;">Date de naissance</div>
                                                <div id="v_dob" style="font-size:14px;color:#111827;"></div>
                                          </div>
                                          <div>
                                                <div style="font-size:12px;color:#6b7280;font-weight:700;">Lieu</div>
                                                <div id="v_lieu" style="font-size:14px;color:#111827;"></div>
                                          </div>
                                          <div>
                                                <div style="font-size:12px;color:#6b7280;font-weight:700;">Nationalité</div>
                                                <div id="v_nat" style="font-size:14px;color:#111827;"></div>
                                          </div>
                                          <div>
                                                <div style="font-size:12px;color:#6b7280;font-weight:700;">NIN</div>
                                                <div id="v_nin" style="font-size:14px;color:#111827;"></div>
                                          </div>
                                          <div>
                                                <div style="font-size:12px;color:#6b7280;font-weight:700;">Email</div>
                                                <div id="v_email" style="font-size:14px;color:#111827;"></div>
                                          </div>
                                          <div style="grid-column: 1 / -1;">
                                                <div style="font-size:12px;color:#6b7280;font-weight:700;">Adresse</div>
                                                <div id="v_addr" style="font-size:14px;color:#111827;"></div>
                                          </div>
                                    </div>
                                    <div style="width:220px;text-align:center;flex-shrink:0;">
                                          <img id="v_photo" src="images/happy.gif" style="width:220px;height:220px;border-radius:12px;object-fit:cover;"/>
                                    </div>
                              </div>
                              <hr style="margin:12px 0"/>
                              <div>
                                    <h4 class="font-semibold">Documents</h4>
                                    <div style="display:flex;gap:12px;margin-top:8px;align-items:flex-start;">
                                          <div style="flex:1">
                                                <div><strong>Extrait de naissance</strong></div>
                                                <div id="v_extrait_preview" style="margin-top:6px;"></div>
                                                <div style="margin-top:6px;display:flex;gap:8px;align-items:center;">
                                                      <label class="file-picker">
                                                            <span class="file-label">Choisir un fichier</span>
                                                            <input class="file-input" id="picker_extrait" type="file" accept="image/*" />
                                                      </label>
                                                      <button id="upload_extrait_btn" class="upload-btn">Upload</button>
                                                      <div id="extrait_filename" style="font-size:13px;color:#6b7280;">Aucun fichier choisi</div>
                                                </div>
                                          </div>
                                          <div style="flex:1">
                                                <div><strong>Carte d'identité</strong></div>
                                                <div id="v_carte_preview" style="margin-top:6px;"></div>
                                                <div style="margin-top:6px;display:flex;gap:8px;align-items:center;">
                                                      <label class="file-picker">
                                                            <span class="file-label">Choisir un fichier</span>
                                                            <input class="file-input" id="picker_carte" type="file" accept="image/*" />
                                                      </label>
                                                      <button id="upload_carte_btn" class="upload-btn">Upload</button>
                                                      <div id="carte_filename" style="font-size:13px;color:#6b7280;">Aucun fichier choisi</div>
                                                </div>
                                          </div>
                                    </div>
                              </div>
                              <div style="margin-top:12px;text-align:right;">
                                    <div class="step-controls">
                                          <button id="stepBack" class="step-btn" title="Précédent">Précédent</button>
                                          <button id="stepNext" class="step-btn primary" title="Suivant">Suivant</button>
                                          <button id="verifySave" class="step-btn primary" style="margin-left:4px;">Enregistrer</button>
                                    </div>
                              </div>
                        </div>
                  </div>
            `;
                                                      document.body.appendChild(verifyModal);

                                                      let currentVerifyId = null;
                                                      let currentVerifyStep = 0;

                                                      function renderProgress(step){
                                                            const labels = ['Info personnelles','Documents','Email','Vérifié'];
                                                            const c = document.getElementById('verifyProgress');
                                                            c.innerHTML = '';
                                                            currentVerifyStep = Number(step) || 0;
                                                            c.style.display = 'flex'; c.style.alignItems = 'center'; c.style.gap = '8px';
                                                            const connectors = [];
                                                            labels.forEach((lbl, i)=>{
                                                                  const el = document.createElement('div');
                                                                  el.style.display = 'flex'; el.style.flexDirection = 'column'; el.style.alignItems = 'center'; el.style.minWidth = '60px';
                                                                  const active = i <= step;
                                                                  el.innerHTML = `<div class='verify-circle' style='width:30px;height:30px;border-radius:15px;border:2px solid ${active?"#10b981":"#e6e8eb"};display:flex;align-items:center;justify-content:center;background:${active?"#10b981":"transparent"};color:${active?"#fff":"#374151"};font-weight:700;transition:transform 250ms ease, background 250ms ease,border-color 250ms ease'>${i+1}</div><div style='font-size:12px;margin-top:8px;color:#374151;'>${lbl}</div>`;
                                                                  el.addEventListener('click', ()=>{ setVerifyStep(currentVerifyId, i); });
                                                                  c.appendChild(el);
                                                                  if (i < labels.length - 1){
                                                                        const conn = document.createElement('div'); conn.className = 'verify-connector'; conn.style.flex = '1 1 auto'; conn.style.height = '6px'; conn.style.borderRadius = '4px'; conn.style.background = '#e6e8eb'; conn.style.transform = 'scaleX(0)'; conn.style.transformOrigin = 'left center'; conn.style.transition = 'transform 420ms ease, background 420ms ease';
                                                                        const wrapper = document.createElement('div'); wrapper.style.display = 'flex'; wrapper.style.alignItems = 'center'; wrapper.appendChild(conn); c.appendChild(wrapper); connectors.push({el: conn, index: i});
                                                                  }
                                                            });
                                                            setTimeout(()=>{
                                                                  connectors.forEach(item => {
                                                                        if (item.index < currentVerifyStep){ item.el.style.transform = 'scaleX(1)'; item.el.style.background = '#10b981'; } else { item.el.style.transform = 'scaleX(0)'; item.el.style.background = '#e6e8eb'; }
                                                                  });
                                                                  try{ const activeCircle = c.querySelectorAll('.verify-circle')[currentVerifyStep]; if (activeCircle){ activeCircle.style.transform = 'scale(1.06)'; setTimeout(()=>{ activeCircle.style.transform = 'scale(1)'; }, 220); } }catch(e){}
                                                            }, 30);
                                                            try{ updateStepButtons(); }catch(e){}
                                                      }

                                                      function openVerifyModal(id){
                                                            currentVerifyId = id; console.debug('[verify] openVerifyModal start id=', id);
                                                            verifyModal.classList.remove('hidden'); document.body.style.overflow = 'hidden';
                                                            fetch(`/etudiants/${id}/json/`).then(r=>{ if(!r.ok) return r.text().then(t=>{ throw new Error(t||r.statusText); }); return r.json(); }).then(json=>{
                                                                  if (!json.success) return alert('Erreur chargement');
                                                                  const e = json.etudiant;
                                                                  document.getElementById('v_nom').textContent = e.nom || '';
                                                                  document.getElementById('v_prenom').textContent = e.prenom || '';
                                                                  document.getElementById('v_sexe').textContent = e.sexe || '';
                                                                  function formatDateForDisplay(raw){ if(!raw) return ''; try{ const iso = raw; if(/^\d{4}-\d{2}-\d{2}$/.test(iso)){ const p = iso.split('-'); return `${p[2]}/${p[1]}/${p[0]}`; } return raw; }catch(e){ return raw || ''; } }
                                                                  document.getElementById('v_dob').textContent = formatDateForDisplay(e.date_naissance || '');
                                                                  document.getElementById('v_lieu').textContent = e.lieu_naissance || '';
                                                                  document.getElementById('v_nat').textContent = e.nationalite || '';
                                                                  document.getElementById('v_nin').textContent = e.nin || '';
                                                                  document.getElementById('v_addr').textContent = e.adresse || '';
                                                                  document.getElementById('v_email').textContent = e.email || '';
                                                                  const photoUrl = e.photo_url || (e.photo ? ('/' + e.photo) : 'images/happy.gif');
                                                                  document.getElementById('v_photo').src = photoUrl;
                                                                  const extraitUrl = e.extrait_naissance_photo_url || (e.extrait_naissance_photo ? ('/' + e.extrait_naissance_photo) : '');
                                                                  if (extraitUrl){ document.getElementById('v_extrait_preview').innerHTML = `<img src="${extraitUrl}" style="max-width:180px;max-height:140px;"/>`; if(document.getElementById('extrait_filename')) document.getElementById('extrait_filename').textContent = extractBasename(extraitUrl); } else { document.getElementById('v_extrait_preview').innerHTML = '<div class="muted">Aucun</div>'; if(document.getElementById('extrait_filename')) document.getElementById('extrait_filename').textContent = 'Aucun fichier choisi'; }
                                                                  const carteUrl = e.carte_identite_photo_url || (e.carte_identite_photo ? ('/' + e.carte_identite_photo) : '');
                                                                  if (carteUrl){ document.getElementById('v_carte_preview').innerHTML = `<img src="${carteUrl}" style="max-width:180px;max-height:140px;"/>`; if(document.getElementById('carte_filename')) document.getElementById('carte_filename').textContent = extractBasename(carteUrl); } else { document.getElementById('v_carte_preview').innerHTML = '<div class="muted">Aucun</div>'; if(document.getElementById('carte_filename')) document.getElementById('carte_filename').textContent = 'Aucun fichier choisi'; }
                                                                  currentVerifyStep = Number(e.verification_step) || 0;
                                                                  renderProgress(currentVerifyStep);
                                                            }).catch(err=>{ console.error(err); alert('Erreur chargement'); });
                                                      }

                                                      function closeVerifyModal(){ verifyModal.classList.add('hidden'); try{ document.body.style.overflow = ''; }catch(e){} }

                                                      document.addEventListener('click', function(e){ const v = e.target.closest('.verify-btn'); if (v){ const id = v.dataset.id; openVerifyModal(id); } });

                                                      document.addEventListener('click', function(e){ const badge = e.target.closest('.status-actif, .status-inactif'); if (!badge) return; if (e.target.closest('a')) return; const row = badge.closest('[data-id]'); if (!row) return; const id = row.dataset.id; try{ openVerifyModal(id); }catch(err){ console.warn('openVerifyModal failed', err); } });

                                                      document.addEventListener('keydown', function(e){ if (e.key !== 'Enter' && e.key !== ' ') return; const active = document.activeElement; if (!active) return; if (!active.classList.contains('status-actif') && !active.classList.contains('status-inactif')) return; e.preventDefault(); const row = active.closest('[data-id]'); if (!row) return; const id = row.dataset.id; try{ openVerifyModal(id); }catch(err){ console.warn('openVerifyModal failed', err); } });

                                                      // wire close buttons once modal exists in DOM
                                                      // delegated because elements may be recreated
                                                      document.addEventListener('click', function delegatedClose(e){ if (e.target && (e.target.id === 'closeVerify' || e.target.id === 'verifyCancelTop')){ closeVerifyModal(); } });

                                                      function extractBasename(path){ if(!path) return ''; try{ const parts = String(path).split(/[\\\/]/); return parts[parts.length-1].substr(0,60); }catch(e){ return path; } }

                                                      // file picker handlers
                                                      document.addEventListener('change', function(e){ if (e.target && e.target.id === 'picker_extrait'){ const f = e.target.files[0]; const el = document.getElementById('extrait_filename'); if(el) el.textContent = f ? f.name : 'Aucun fichier choisi'; } if (e.target && e.target.id === 'picker_carte'){ const f = e.target.files[0]; const el = document.getElementById('carte_filename'); if(el) el.textContent = f ? f.name : 'Aucun fichier choisi'; } });

                                                      // delegated upload handlers
                                                      document.addEventListener('click', function delegatedUploads(e){
                                                            const btn = e.target.closest('#upload_extrait_btn');
                                                            if (btn){ e.preventDefault(); const f = (document.getElementById('picker_extrait')||{}).files && document.getElementById('picker_extrait').files[0]; if(!f){ const preview = document.getElementById('v_extrait_preview'); let m = document.getElementById('v_extrait_error'); if(!m){ m = document.createElement('div'); m.id='v_extrait_error'; m.className='text-sm text-red-600 mt-1'; preview.parentNode.insertBefore(m, preview.nextSibling); } m.textContent = 'Choisir un fichier'; return; } try{ const r = new FileReader(); r.onload = ev => { document.getElementById('v_extrait_preview').innerHTML = `<img src="${ev.target.result}" style="max-width:180px;max-height:140px;"/>`; }; r.readAsDataURL(f); }catch(e){} const fd = new FormData(); fd.append('file', f); fd.append('type', 'extrait'); fetch(`/etudiants/${currentVerifyId}/upload-doc/`, { method:'POST', body: fd, credentials:'same-origin', headers: { 'X-CSRFToken': csrftoken } }).then(r=>{ if (!r.ok) return r.text().then(t=>{ throw new Error(t||r.statusText); }); return r.json(); }).then(json=>{ if (json.success){ const url = json.url || ('/' + (json.path||'')).replace(/\\/g,'/'); document.getElementById('v_extrait_preview').innerHTML = `<img src="${url}" style="max-width:180px;max-height:140px;"/>`; if (document.getElementById('extrait_filename')) document.getElementById('extrait_filename').textContent = 'Aucun fichier choisi'; if (document.getElementById('picker_extrait')) document.getElementById('picker_extrait').value = ''; const errEl = document.getElementById('v_extrait_error'); if(errEl) errEl.remove(); } else { const preview = document.getElementById('v_extrait_preview'); let m = document.getElementById('v_extrait_error'); if(!m){ m = document.createElement('div'); m.id='v_extrait_error'; m.className='text-sm text-red-600 mt-1'; preview.parentNode.insertBefore(m, preview.nextSibling); } m.textContent = 'Erreur upload: '+(json.error||''); } }).catch(err=>{ const preview = document.getElementById('v_extrait_preview'); let m = document.getElementById('v_extrait_error'); if(!m){ m = document.createElement('div'); m.id='v_extrait_error'; m.className='text-sm text-red-600 mt-1'; preview.parentNode.insertBefore(m, preview.nextSibling); } m.textContent = 'Erreur upload'; }); return; }
                                                            const btn2 = e.target.closest('#upload_carte_btn');
                                                            if (btn2){ e.preventDefault(); const f = (document.getElementById('picker_carte')||{}).files && document.getElementById('picker_carte').files[0]; if(!f){ const preview = document.getElementById('v_carte_preview'); let m = document.getElementById('v_carte_error'); if(!m){ m = document.createElement('div'); m.id='v_carte_error'; m.className='text-sm text-red-600 mt-1'; preview.parentNode.insertBefore(m, preview.nextSibling); } m.textContent = 'Choisir un fichier'; return; } try{ const r = new FileReader(); r.onload = ev => { document.getElementById('v_carte_preview').innerHTML = `<img src="${ev.target.result}" style="max-width:180px;max-height:140px;"/>`; }; r.readAsDataURL(f); }catch(e){} const fd = new FormData(); fd.append('file', f); fd.append('type', 'carte'); fetch(`/etudiants/${currentVerifyId}/upload-doc/`, { method:'POST', body: fd, credentials:'same-origin', headers: { 'X-CSRFToken': csrftoken } }).then(r=>{ if (!r.ok) return r.text().then(t=>{ throw new Error(t||r.statusText); }); return r.json(); }).then(json=>{ if (json.success){ const url = json.url || ('/' + (json.path||'')).replace(/\\/g,'/'); document.getElementById('v_carte_preview').innerHTML = `<img src="${url}" style="max-width:180px;max-height:140px;"/>`; if (document.getElementById('carte_filename')) document.getElementById('carte_filename').textContent = 'Aucun fichier choisi'; if (document.getElementById('picker_carte')) document.getElementById('picker_carte').value = ''; const errEl = document.getElementById('v_carte_error'); if(errEl) errEl.remove(); } else { const preview = document.getElementById('v_carte_preview'); let m = document.getElementById('v_carte_error'); if(!m){ m = document.createElement('div'); m.id='v_carte_error'; m.className='text-sm text-red-600 mt-1'; preview.parentNode.insertBefore(m, preview.nextSibling); } m.textContent = 'Erreur upload: '+(json.error||''); } }).catch(err=>{ const preview = document.getElementById('v_carte_preview'); let m = document.getElementById('v_carte_error'); if(!m){ m = document.createElement('div'); m.id='v_carte_error'; m.className='text-sm text-red-600 mt-1'; preview.parentNode.insertBefore(m, preview.nextSibling); } m.textContent = 'Erreur upload'; }); return; }
                                                      });

                                                      // legacy form handlers (no-op if not present)
                                                      const legacyUploadEx = document.getElementById('upload_extrait'); if (legacyUploadEx){ legacyUploadEx.addEventListener('submit', function(e){ e.preventDefault(); const f = e.target.querySelector('input[type=file]').files[0]; if (!f){ const preview = document.getElementById('v_extrait_preview'); let m = document.getElementById('v_extrait_error'); if(!m){ m = document.createElement('div'); m.id='v_extrait_error'; m.className='text-sm text-red-600 mt-1'; preview.parentNode.insertBefore(m, preview.nextSibling); } m.textContent = 'Choisir un fichier'; return; } try{ const reader = new FileReader(); reader.onload = ev => { document.getElementById('v_extrait_preview').innerHTML = `<img src="${ev.target.result}" style="max-width:180px;max-height:140px;"/>`; }; reader.readAsDataURL(f); }catch(err){} const fd = new FormData(); fd.append('file', f); fd.append('type', 'extrait'); fetch(`/etudiants/${currentVerifyId}/upload-doc/`, { method:'POST', body: fd, credentials:'same-origin', headers: { 'X-CSRFToken': csrftoken } }).then(r => { if (!r.ok) return r.text().then(t => { throw new Error(t || r.statusText); }); return r.json(); }).then(json=>{ if (json.success){ if (json.url) { document.getElementById('v_extrait_preview').innerHTML = `<img src="${json.url}" style="max-width:180px;max-height:140px;"/>`; } else if (json.path) { const p = ('/' + String(json.path)).replace(/\\/g, '/'); document.getElementById('v_extrait_preview').innerHTML = `<img src="${p}" style="max-width:180px;max-height:140px;"/>`; } } else { alert('Erreur upload: '+(json.error||'')); } }).catch(err=>{ console.error(err); alert('Erreur upload'); }); }); }

                                                      const legacyUploadCarte = document.getElementById('upload_carte'); if (legacyUploadCarte){ legacyUploadCarte.addEventListener('submit', function(e){ e.preventDefault(); const f = e.target.querySelector('input[type=file]').files[0]; if (!f){ const preview = document.getElementById('v_carte_preview'); let m = document.getElementById('v_carte_error'); if(!m){ m = document.createElement('div'); m.id='v_carte_error'; m.className='text-sm text-red-600 mt-1'; preview.parentNode.insertBefore(m, preview.nextSibling); } m.textContent = 'Choisir un fichier'; return; } try{ const reader = new FileReader(); reader.onload = ev => { document.getElementById('v_carte_preview').innerHTML = `<img src="${ev.target.result}" style="max-width:180px;max-height:140px;"/>`; }; reader.readAsDataURL(f); }catch(err){} const fd = new FormData(); fd.append('file', f); fd.append('type', 'carte'); fetch(`/etudiants/${currentVerifyId}/upload-doc/`, { method:'POST', body: fd, credentials:'same-origin', headers: { 'X-CSRFToken': csrftoken } }).then(r => { if (!r.ok) return r.text().then(t => { throw new Error(t || r.statusText); }); return r.json(); }).then(json=>{ if (json.success){ if (json.url) { document.getElementById('v_carte_preview').innerHTML = `<img src="${json.url}" style="max-width:180px;max-height:140px;"/>`; } else if (json.path) { const p = ('/' + String(json.path)).replace(/\\/g, '/'); document.getElementById('v_carte_preview').innerHTML = `<img src="${p}" style="max-width:180px;max-height:140px;"/>`; } } else { alert('Erreur upload: '+(json.error||'')); } }).catch(err=>{ console.error(err); alert('Erreur upload'); }); }); }

                                                      // Save and step controls
                                                      document.addEventListener('click', function(e){ if (e.target && e.target.id === 'verifySave'){ closeVerifyModal(); } });

                                                      function setVerifyStep(id, step){ const targetId = id || currentVerifyId; if (!targetId) return alert('Aucun étudiant sélectionné'); const fd = new FormData(); fd.append('step', step); fetch(`/etudiants/${targetId}/update-step/`, { method:'POST', body: fd, credentials:'same-origin', headers: { 'X-CSRFToken': csrftoken } }).then(r=>{ if (!r.ok) return r.text().then(t=>{ throw new Error(t||r.statusText); }); return r.json(); }).then(json=>{ if (json.success){ renderProgress(json.step); } else { alert('Erreur étape'); } }).catch(err=>{ console.error('setVerifyStep', err); alert('Erreur mise à jour'); }); }

                                                      function updateStepButtons(){ const back = document.getElementById('stepBack'); const next = document.getElementById('stepNext'); if (!back || !next) return; back.disabled = (currentVerifyStep <= 0); next.disabled = (currentVerifyStep >= 3); if (back.disabled) back.classList.add('disabled'); else back.classList.remove('disabled'); if (next.disabled) next.classList.add('disabled'); else next.classList.remove('disabled'); }

                                                      document.addEventListener('click', function(e){ if (e.target && e.target.id === 'stepNext'){ if (currentVerifyId !== null){ const next = Math.min(3, Number(currentVerifyStep) + 1); setVerifyStep(currentVerifyId, next); } } if (e.target && e.target.id === 'stepBack'){ if (currentVerifyId !== null){ const prev = Math.max(0, Number(currentVerifyStep) - 1); setVerifyStep(currentVerifyId, prev); } } });
                                                      </script>
                                                      <script>
                                                      // Re-create the recent-list interaction helpers so loadRecent can call setupRecentInteractions()
                                                      function setupRecentInteractions(){
                                                            const list = document.getElementById('recent-list');
                                                            if(!list) return;
                                                            list.removeEventListener('click', recentClickHandler);
                                                            list.addEventListener('click', recentClickHandler);
                                                            list.removeEventListener('keydown', recentKeyHandler);
                                                            list.addEventListener('keydown', recentKeyHandler);
                                                      }

                                                      function recentKeyHandler(e){
                                                            if(e.key === 'Enter' || e.key === ' '){
                                                                  const li = e.target.closest('.recent-item');
                                                                  if(li) { e.preventDefault(); openVerifyModal(li.dataset.id); }
                                                            }
                                                      }

                                                      function recentClickHandler(e){
                                                            const li = e.target.closest('.recent-item');
                                                            if(!li) return;
                                                            const id = li.dataset.id;
                                                            if(!id) return;
                                                            openVerifyModal(id);
                                                      }
                                                      </script>
        </div>

      <div class="card p-6 bg-white shadow-sm border border-gray-100 rounded-lg">
            <div class="flex items-center mb-2">
                  <div class="mr-3 header-icon" aria-hidden="true">
                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="18" rx="4" fill="#ecfccb"/><path d="M7 15v-6" stroke="#65a30d" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 15V9" stroke="#16a34a" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M17 15v-4" stroke="#059669" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  </div>
                  <h3 class="text-xl md:text-2xl font-extrabold mb-0">Répartition par niveau</h3>
            </div>
            <p class="text-base text-gray-600 mb-4">Répartition des étudiants par niveau — aperçu visuel et chiffres</p>
            <style>
            .header-icon { opacity:0.95; }
            .text-2xl.md\:text-3xl { line-height:1; }
            /* level bars: larger and more prominent */
            .lvl-bar { display:block; height: 1.1rem; border-radius: 9999px; transform-origin: left center; transition: width .8s ease; overflow:hidden; }
            .lvl-bar-inner { display:block; height:100%; border-radius:9999px; }
            .lvl-row { display:flex; justify-content:space-between; align-items:center; gap:12px; }
            .level-name { font-size:1rem; font-weight:700; color:#0f172a; display:flex; align-items:center; gap:8px; }
            .level-count { font-size:0.95rem; color:#374151; }
            .lvl-icon { width:20px; height:20px; display:inline-block; opacity:0.9; }
            .lvl-icon svg { width:100%; height:100%; display:block; }
            .lvl-fill { transition: width 1s cubic-bezier(.2,.9,.2,1); }
            </style>
            <div class="space-y-3">
                  
                        <div class="lvl-row">
                              <div style="flex:1; margin-right:12px;">
                                    <div class="w-full bg-gray-100 rounded-full h-4 overflow-hidden lvl-bar">
                                          
                                                <span class="lvl-fill" data-pct="79%" style="width:0; background:#16a34a"></span>
                                          
                                    </div>
                              </div>
                              <div style="width:220px; text-align:right;">
                                    <div class="level-name"><span class="lvl-icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="8" r="3" fill="#fde68a"/><path d="M4 20c1.5-3 4-5 8-5s6.5 2 8 5" stroke="#f59e0b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>Non spécifié</div>
                                    <div class="level-count">23 (79%)</div>
                              </div>
                        </div>
                  
                        <div class="lvl-row">
                              <div style="flex:1; margin-right:12px;">
                                    <div class="w-full bg-gray-100 rounded-full h-4 overflow-hidden lvl-bar">
                                          
                                                <span class="lvl-fill" data-pct="13%" style="width:0; background:#f59e0b"></span>
                                          
                                    </div>
                              </div>
                              <div style="width:220px; text-align:right;">
                                    <div class="level-name"><span class="lvl-icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="8" r="3" fill="#fde68a"/><path d="M4 20c1.5-3 4-5 8-5s6.5 2 8 5" stroke="#f59e0b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>Terminal</div>
                                    <div class="level-count">4 (13%)</div>
                              </div>
                        </div>
                  
                        <div class="lvl-row">
                              <div style="flex:1; margin-right:12px;">
                                    <div class="w-full bg-gray-100 rounded-full h-4 overflow-hidden lvl-bar">
                                          
                                                <span class="lvl-fill" data-pct="6%" style="width:0; background:#ef4444"></span>
                                          
                                    </div>
                              </div>
                              <div style="width:220px; text-align:right;">
                                    <div class="level-name"><span class="lvl-icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="8" r="3" fill="#fde68a"/><path d="M4 20c1.5-3 4-5 8-5s6.5 2 8 5" stroke="#f59e0b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>universitaire</div>
                                    <div class="level-count">2 (6%)</div>
                              </div>
                        </div>
                  
                  </div>
                  
      </div>
</div>
</div>
</section>
<section class="mt-10">
<h2 class="text-xl font-semibold section-title mb-4">Finances</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
<!-- recent students card removed as requested -->
<div class="card p-6 flex flex-col block">
      <div class="flex items-center mb-4">
            <div class="p-3 bg-green-100 rounded-lg mr-4">
                  <span class="material-icons text-green-600">groups</span>
            </div>
            <h3 class="text-lg font-semibold">Groupes &amp; Occupation</h3>
      </div>
      <p class="text-sm mb-2 flex-grow">Total de groupes (toutes formations) et taux d'occupation</p>
      <div class="flex justify-between items-center text-sm">
            <div>
                  <p class="text-2xl font-bold stat-value">{{ group_count|default:0 }}</p>
                  <p class="stat-label">Groupes</p>
            </div>
            <div class="text-right">
                  <p class="text-2xl font-bold text-premium-green">{{ salle_occupation_percent|default:0 }}%</p>
                  <p class="stat-label">Salles occupées aujourd'hui</p>
            </div>
      </div>
      <div class="occupation-visual">
            <div class="occ-track"><div class="occ-fill" data-pct="{{ salle_occupation_percent|default:0 }}%" style="width:{{ salle_occupation_percent|default:0 }}%"></div></div>
            <div class="occ-meta"><div class="occ-label">Salles occupées (maintenant)</div><div class="occ-pct">{{ salle_occupied_count|default:0 }} / {{ salle_count|default:0 }}</div></div>
      </div>
      <div class="icon-deco" aria-hidden="true">
            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="6" fill="#16a34a"/><circle cx="38" cy="14" r="4" fill="#06b6d4"/><circle cx="30" cy="36" r="5" fill="#34d399"/></svg>
      </div>
</div>
      <div class="card p-6">
            <h3 class="text-lg font-semibold mb-2">Net Profit</h3>
            <div class="flex items-center mb-3">
                  <div class="p-3 bg-yellow-50 rounded-lg mr-4 money-icon-wrap" aria-hidden="true">
                        <!-- decorative money/coin icon -->
                        <svg class="money-icon" viewBox="0 0 64 64" width="32" height="32" xmlns="http://www.w3.org/2000/svg" fill="none">
                              <circle cx="32" cy="32" r="28" fill="#FDE68A" />
                              <path d="M32 20c4 0 6 1 6 3s-2 3-6 3-6-1-6-3 2-3 6-3z" fill="#D97706" opacity="0.3"/>
                              <text x="32" y="40" text-anchor="middle" font-size="18" font-weight="700" fill="#92400E">DA</text>
                        </svg>
                  </div>
                  <label for="netprofit-range" class="text-sm text-gray-600 mr-3">Période:</label>
                  <select id="netprofit-range" class="border bg-white rounded-md px-3 py-1 text-sm shadow-sm">
                        <option value="day">Jour</option>
                        <option value="month">Mois</option>
                        <option value="year">Annuel</option>
                  </select>
            </div>
            <div class="flex items-center">
                  <div class="netprofit-number">
                        <span id="netprofit-value" class="netprofit-value" data-day="0" data-month="210.00" data-year="3384277.00">0.00</span>
                        <span class="netprofit-currency"> DA</span>
                  </div>
                  <div class="ml-4 hidden sm:block">
                        <svg class="mini-money" width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                              <path d="M12 1v2" stroke="#f59e0b" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                              <path d="M7 5h10a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V8a3 3 0 0 1 3-3z" stroke="#f59e0b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                              <path d="M12 9v6" stroke="#92400E" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                  </div>
            </div>
            <p class="text-sm text-gray-500 mt-2 netprofit-sub">Net profit pour la période sélectionnée</p>
            <style>
            /* Net profit visual styling */
            .netprofit-number { display:flex; align-items:baseline; gap:8px; }
            /* Enlarged main net profit number and emphasized currency (DA) with underline */
            /* Use a digital/arcade style font for the main profit number to evoke old-school match scores */
            .netprofit-value { font-family: 'Orbitron', 'Segoe UI', Roboto, Arial, monospace; font-weight:900; font-size:3rem; line-height:1; letter-spacing:0.5px; color:#0f172a; background:none; -webkit-text-fill-color: initial; }
            .netprofit-currency { font-weight:800; font-size:1.25rem; color:#0f172a; opacity:0.95; margin-left:8px; text-decoration:none; }
            .money-icon { transition: transform .6s ease, opacity .4s ease; transform-origin:center; }
            .money-icon.float { animation: floatCoin 2s ease-in-out infinite; }
            @keyframes floatCoin { 0% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-6px) rotate(8deg); } 100% { transform: translateY(0) rotate(0deg); } }
            .netprofit-value.jolt { animation: joltNum .45s ease; }
            @keyframes joltNum { 0% { transform: translateY(0) scale(1); } 30% { transform: translateY(-6px) scale(1.03); } 100% { transform: translateY(0) scale(1); } }
            .mini-money { opacity:0.9; transform-origin:center; transition: transform .45s ease; }
            .mini-money.pulse { transform: scale(1.12); }
            </style>
      </div>

      <div class="card p-6 lg:row-span-2 flex flex-col rev-card">
            <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center">
                        <div class="rev-header-icon mr-3" aria-hidden="true"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="20" height="20" rx="6" fill="#eef2ff"/><path d="M7 13c1.5-2 4-3 5-3s3.5 1 5 3" stroke="#0ea5a4" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 7v2" stroke="#06b6d4" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                        <h3 class="text-xl md:text-2xl font-extrabold mb-0">Revenus par formation <small class="text-sm text-gray-500">(10 formations)</small></h3>
                  </div>
                  <div class="rev-actions">
                        <button class="rev-filter btn-sm" title="Trier">Trier</button>
                  </div>
            </div>
                                    <div class="rev-list-container flex-grow overflow-auto">
                                          <ul class="mt-2 text-lg space-y-3 rev-list">
                    
                    
                          clr-a
                          <li class="rev-item clr-a" tabindex="0">
                                <div class="rev-left">
                                      <span class="rev-icon" aria-hidden="true">
                                            <svg viewBox="0 0 24 24" width="28" height="28" xmlns="http://www.w3.org/2000/svg" fill="none">
                                                <circle cx="12" cy="12" r="10" fill="rgba(255,255,255,0.08)"/>
                                                <path d="M12 8v8" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M9 10h6a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2H9" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                      </span>
                                      <span class="rev-name">Mathématiques Appliquées</span>
                                </div>
                                <div class="rev-right">
                                      <span class="rev-value" data-total="3336946.00">0</span>
                                      <span class="rev-currency"> DA</span>
                                </div>
                          </li>
                    
                          clr-b
                          <li class="rev-item clr-b" tabindex="0">
                                <div class="rev-left">
                                      <span class="rev-icon" aria-hidden="true">
                                            <svg viewBox="0 0 24 24" width="28" height="28" xmlns="http://www.w3.org/2000/svg" fill="none">
                                                <circle cx="12" cy="12" r="10" fill="rgba(255,255,255,0.08)"/>
                                                <path d="M12 8v8" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M9 10h6a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2H9" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                      </span>
                                      <span class="rev-name">CYBERSECURITY</span>
                                </div>
                                <div class="rev-right">
                                      <span class="rev-value" data-total="23444.00">0</span>
                                      <span class="rev-currency"> DA</span>
                                </div>
                          </li>
                    
                          clr-c
                          <li class="rev-item clr-c" tabindex="0">
                                <div class="rev-left">
                                      <span class="rev-icon" aria-hidden="true">
                                            <svg viewBox="0 0 24 24" width="28" height="28" xmlns="http://www.w3.org/2000/svg" fill="none">
                                                <circle cx="12" cy="12" r="10" fill="rgba(255,255,255,0.08)"/>
                                                <path d="M12 8v8" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M9 10h6a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2H9" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                      </span>
                                      <span class="rev-name">Gestion &amp; Finance</span>
                                </div>
                                <div class="rev-right">
                                      <span class="rev-value" data-total="23363.00">0</span>
                                      <span class="rev-currency"> DA</span>
                                </div>
                          </li>
                    
                          clr-d
                          <li class="rev-item clr-d" tabindex="0">
                                <div class="rev-left">
                                      <span class="rev-icon" aria-hidden="true">
                                            <svg viewBox="0 0 24 24" width="28" height="28" xmlns="http://www.w3.org/2000/svg" fill="none">
                                                <circle cx="12" cy="12" r="10" fill="rgba(255,255,255,0.08)"/>
                                                <path d="M12 8v8" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M9 10h6a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2H9" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                      </span>
                                      <span class="rev-name">Design Web</span>
                                </div>
                                <div class="rev-right">
                                      <span class="rev-value" data-total="524.00">0</span>
                                      <span class="rev-currency"> DA</span>
                                </div>
                          </li>
                    
                          clr-e
                          <li class="rev-item clr-e" tabindex="0">
                                <div class="rev-left">
                                      <span class="rev-icon" aria-hidden="true">
                                            <svg viewBox="0 0 24 24" width="28" height="28" xmlns="http://www.w3.org/2000/svg" fill="none">
                                                <circle cx="12" cy="12" r="10" fill="rgba(255,255,255,0.08)"/>
                                                <path d="M12 8v8" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M9 10h6a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2H9" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                      </span>
                                      <span class="rev-name">Informatique</span>
                                </div>
                                <div class="rev-right">
                                      <span class="rev-value" data-total="0">0</span>
                                      <span class="rev-currency"> DA</span>
                                </div>
                          </li>
                    
                          clr-a
                          <li class="rev-item clr-a" tabindex="0">
                                <div class="rev-left">
                                      <span class="rev-icon" aria-hidden="true">
                                            <svg viewBox="0 0 24 24" width="28" height="28" xmlns="http://www.w3.org/2000/svg" fill="none">
                                                <circle cx="12" cy="12" r="10" fill="rgba(255,255,255,0.08)"/>
                                                <path d="M12 8v8" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M9 10h6a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2H9" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                      </span>
                                      <span class="rev-name">Marketing Digital</span>
                                </div>
                                <div class="rev-right">
                                      <span class="rev-value" data-total="0">0</span>
                                      <span class="rev-currency"> DA</span>
                                </div>
                          </li>
                    
                          clr-b
                          <li class="rev-item clr-b" tabindex="0">
                                <div class="rev-left">
                                      <span class="rev-icon" aria-hidden="true">
                                            <svg viewBox="0 0 24 24" width="28" height="28" xmlns="http://www.w3.org/2000/svg" fill="none">
                                                <circle cx="12" cy="12" r="10" fill="rgba(255,255,255,0.08)"/>
                                                <path d="M12 8v8" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M9 10h6a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2H9" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                      </span>
                                      <span class="rev-name">Resauxxw</span>
                                </div>
                                <div class="rev-right">
                                      <span class="rev-value" data-total="0">0</span>
                                      <span class="rev-currency"> DA</span>
                                </div>
                          </li>
                    
                          clr-c
                          <li class="rev-item clr-c" tabindex="0">
                                <div class="rev-left">
                                      <span class="rev-icon" aria-hidden="true">
                                            <svg viewBox="0 0 24 24" width="28" height="28" xmlns="http://www.w3.org/2000/svg" fill="none">
                                                <circle cx="12" cy="12" r="10" fill="rgba(255,255,255,0.08)"/>
                                                <path d="M12 8v8" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M9 10h6a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2H9" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                      </span>
                                      <span class="rev-name">dfdfdf</span>
                                </div>
                                <div class="rev-right">
                                      <span class="rev-value" data-total="0">0</span>
                                      <span class="rev-currency"> DA</span>
                                </div>
                          </li>
                    
                          clr-d
                          <li class="rev-item clr-d" tabindex="0">
                                <div class="rev-left">
                                      <span class="rev-icon" aria-hidden="true">
                                            <svg viewBox="0 0 24 24" width="28" height="28" xmlns="http://www.w3.org/2000/svg" fill="none">
                                                <circle cx="12" cy="12" r="10" fill="rgba(255,255,255,0.08)"/>
                                                <path d="M12 8v8" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M9 10h6a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2H9" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                      </span>
                                      <span class="rev-name">SOFTWARE TESTING</span>
                                </div>
                                <div class="rev-right">
                                      <span class="rev-value" data-total="0">0</span>
                                      <span class="rev-currency"> DA</span>
                                </div>
                          </li>
                    
                          clr-e
                          <li class="rev-item clr-e" tabindex="0">
                                <div class="rev-left">
                                      <span class="rev-icon" aria-hidden="true">
                                            <svg viewBox="0 0 24 24" width="28" height="28" xmlns="http://www.w3.org/2000/svg" fill="none">
                                                <circle cx="12" cy="12" r="10" fill="rgba(255,255,255,0.08)"/>
                                                <path d="M12 8v8" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M9 10h6a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2H9" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                      </span>
                                      <span class="rev-name">dxd</span>
                                </div>
                                <div class="rev-right">
                                      <span class="rev-value" data-total="0">0</span>
                                      <span class="rev-currency"> DA</span>
                                </div>
                          </li>
                    
              </ul>
            </div>
            <style>
            /* constrain the card height and make inner list scroll */
            /* Increased to match desired visual level without changing other cards */
            .rev-card { max-height: 520px; }
            .rev-list-container { max-height: 420px; overflow:auto; padding-right:6px; }
            /* ensure scrollbar doesn't push layout on small screens */
            .rev-list-container::-webkit-scrollbar { width:8px; }
            .rev-list-container::-webkit-scrollbar-thumb { background: rgba(15,23,42,0.08); border-radius:6px; }
            /* Revenus card: colorful & interactive */
            .rev-card { background: linear-gradient(180deg, #ffffff, #fbfbff); border-radius: 0.6rem; }
            .rev-header-icon { opacity:0.95; }
            .rev-list { padding:8px 2px; }
            .rev-item { display:flex; align-items:center; justify-content:space-between; padding:10px; border-radius:8px; transition: transform .22s ease, box-shadow .22s ease, background .2s ease; cursor:default; }
            .rev-item:focus, .rev-item:hover { transform: translateY(-4px); box-shadow: 0 6px 18px rgba(15,23,42,0.06); }
            .rev-left { display:flex; align-items:center; gap:12px; }
            .rev-name { font-weight:700; color:#0f172a; }
            .rev-right { font-weight:800; font-family: ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto; color:#062f4f; display:flex; align-items:baseline; gap:6px; }
            /* Larger revenue numbers and DA — underline removed as requested */
            .rev-value { font-size:1.5rem; background:linear-gradient(90deg,#06b6d4,#0ea5a4); -webkit-background-clip:text; background-clip:text; color:transparent; text-decoration:none; }
            .rev-currency { font-size:1.05rem; color:#274254; font-weight:800; text-decoration:none; }
            .rev-icon { width:40px; height:40px; display:inline-flex; align-items:center; justify-content:center; border-radius:8px; box-shadow: inset 0 -6px 14px rgba(0,0,0,0.04); }
            .clr-a .rev-icon { background: linear-gradient(135deg,#7dd3fc,#60a5fa); }
            .clr-b .rev-icon { background: linear-gradient(135deg,#fde68a,#fbbf24); }
            .clr-c .rev-icon { background: linear-gradient(135deg,#bbf7d0,#34d399); }
            .clr-d .rev-icon { background: linear-gradient(135deg,#fbcfe8,#f472b6); }
            .clr-e .rev-icon { background: linear-gradient(135deg,#d8b4fe,#a78bfa); }
            </style>
            <script>
            // animate revenue numbers when visible
            (function(){
                  function animateCount(el, to, duration){
                        var start = null; var from = 0; to = parseFloat(to)||0; duration = duration||800;
                        function step(ts){ if(!start) start = ts; var prog = Math.min((ts-start)/duration,1); var cur = from + (to-from)*prog; el.textContent = Math.round(cur).toLocaleString(); if(prog<1) requestAnimationFrame(step); }
                        requestAnimationFrame(step);
                  }
                  function startAnim(){
                        document.querySelectorAll('.rev-value').forEach(function(el,i){
                              var to = el.getAttribute('data-total')||0;
                              setTimeout(function(){ animateCount(el,to,900); }, i*80);
                        });
                  }
                  if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', startAnim); else startAnim();
            })();
            </script>
      </div>

      <div class="card p-6">
            <h3 class="text-lg font-semibold mb-2">Paiements étudiants</h3>
            <div class="flex items-end gap-4 mt-2">
                  <p class="text-3xl font-bold" id="payments-count">14</p>
                  <p class="text-sm text-gray-500">/ 28 inscriptions</p>
            </div>
            <div class="mt-4">
                  <div class="occ-track small">
                        <div class="occ-fill payments-fill" data-pct="50%"></div>
                  </div>
                  <div class="flex justify-between text-sm mt-2">
                        <span>0</span>
                        <span>50%</span>
                  </div>
            </div>
            <p class="text-sm text-gray-500 mt-3">Nombre total de paiements enregistrés pour les étudiants</p>
      </div>
      <div class="card p-6 flex flex-col block">
            <div class="flex items-center mb-4">
                  <div class="p-3 bg-purple-100 rounded-lg mr-4">
                        <span class="material-icons text-purple-600">print</span>
                  </div>
                  <h3 class="text-lg font-semibold">Rapports imprimés</h3>
            </div>
            <p class="text-2xl font-bold">0</p>
            <p class="text-sm text-gray-500 mt-2">Nombre de rapports imprimés</p>
      </div>
</div>
</section>
<footer class="mt-10 flex space-x-4">

</footer>
<script>
document.addEventListener('DOMContentLoaded', function(){
      // apply widths for any element using data-pct to avoid template vars in inline styles
      setTimeout(function(){
            document.querySelectorAll('[data-pct]').forEach(function(el){
                  var pct = el.getAttribute('data-pct') || '0%';
                  if(typeof pct === 'string' && pct.indexOf('%') === -1) pct = pct + '%';
                  el.style.width = pct;
            });
      }, 120);
      // Net profit switcher — initialize and switch
      var netSelect = document.getElementById('netprofit-range');
      var netValue = document.getElementById('netprofit-value');
      function formatNumber(n){
            var num = parseFloat(n) || 0;
            return num.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
      }
      if(netSelect && netValue){
            // set initial value: prefer day if available, then month, then year
            var init = netValue.getAttribute('data-day') || netValue.getAttribute('data-month') || netValue.getAttribute('data-year') || '0';
            // animated counter helper
            function animateNumber(el, from, to, duration){
                  var start = null; from = parseFloat(from)||0; to = parseFloat(to)||0; duration = duration||600;
                  function step(ts){
                        if(!start) start = ts;
                        var progress = Math.min((ts - start)/duration, 1);
                        var cur = from + (to - from) * progress;
                        el.textContent = formatNumber(cur);
                        if(progress < 1) window.requestAnimationFrame(step);
                  }
                  window.requestAnimationFrame(step);
            }
            var currentVal = parseFloat(init)||0;
            netValue.textContent = formatNumber(currentVal);
            netSelect.addEventListener('change', function(){
                  var raw;
                  if(this.value === 'year') raw = netValue.getAttribute('data-year');
                  else if(this.value === 'month') raw = netValue.getAttribute('data-month');
                  else if(this.value === 'day') raw = netValue.getAttribute('data-day');
                  else raw = netValue.getAttribute('data-month');
                  var newVal = parseFloat(raw) || 0;
                  // jolt number and animate icon
                  netValue.classList.add('jolt');
                  setTimeout(function(){ netValue.classList.remove('jolt'); }, 500);
                  var mini = document.querySelector('.mini-money'); if(mini) { mini.classList.add('pulse'); setTimeout(function(){ mini.classList.remove('pulse'); }, 600); }
                  // update main money icon float briefly
                  var bigIcon = document.querySelector('.money-icon'); if(bigIcon){ bigIcon.classList.add('float'); setTimeout(function(){ bigIcon.classList.remove('float'); }, 2200); }
                  // animate numeric transition
                  animateNumber(netValue, currentVal, newVal, 600);
                  currentVal = newVal;
            });
      }
      // animate header stat numbers from 0 to target
      (function(){
            function animate(el, to, duration){
                  var start = null; var from = 0; to = parseInt(to)||0; duration = duration||900;
                  function step(ts){ if(!start) start = ts; var prog = Math.min((ts-start)/duration,1); var cur = Math.round(from + (to-from)*prog); el.textContent = cur.toLocaleString(); if(prog<1) requestAnimationFrame(step); }
                  requestAnimationFrame(step);
            }
            document.querySelectorAll('.stat-num').forEach(function(el,i){
                  var to = el.getAttribute('data-value')||0;
                  setTimeout(function(){ animate(el,to,900); }, i*120);
            });
      })();
});
</script>

  </main>



  <script>
    // Toggle sidebar submenu groups: click header to open/close


    
    document.addEventListener('DOMContentLoaded', function(){
        // Theme initialization and toggle
        try {
          var htmlEl = document.documentElement;
          var saved = null;
          try { saved = localStorage.getItem('theme'); } catch(e) { saved = null; }
          if (!saved) {
            saved = (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light';
          }
          htmlEl.setAttribute('data-theme', saved);
          var toggle = document.getElementById('themeToggle');
          var icon = document.getElementById('themeIcon');
          var toggleSlider = document.querySelector('.toggle-slider');
          if (toggle) {
            toggle.checked = (saved === 'dark');
            // set accessible attribute
            if(toggleSlider) toggleSlider.setAttribute('aria-checked', toggle.checked ? 'true' : 'false');
            toggle.addEventListener('change', function () {
              var theme = toggle.checked ? 'dark' : 'light';
              htmlEl.setAttribute('data-theme', theme);
              try { localStorage.setItem('theme', theme); } catch(e) {}
              if (icon) icon.textContent = theme === 'dark' ? 'dark_mode' : 'light_mode';
              if(toggleSlider) toggleSlider.setAttribute('aria-checked', toggle.checked ? 'true' : 'false');
            });
          }
          if (icon) icon.textContent = (saved === 'dark') ? 'dark_mode' : 'light_mode';
        } catch(e) {}
        document.querySelectorAll('.group-header').forEach(function(h){
          h.setAttribute('role','button');
          h.setAttribute('tabindex','0');
          h.addEventListener('click', function(e){
            // if the click originated from a link inside the header, let it navigate
            if (e.target.closest('a')) return;
            var ul = h.nextElementSibling;
            if(!ul) return;
            ul.classList.toggle('open');
            h.classList.toggle('open');
            // accessibility
            var expanded = ul.classList.contains('open');
            h.setAttribute('aria-expanded', expanded ? 'true' : 'false');
            ul.setAttribute('aria-hidden', expanded ? 'false' : 'true');
          });
          h.addEventListener('keydown', function(e){ if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); h.click(); } });
        });
        // Nav indicator interactivity: move indicator to hovered/active link
        (function(){
          var indicator = document.getElementById('navIndicator');
          var aside = document.querySelector('.sidebar');
          if(!indicator || !aside) return;
          var items = Array.from(aside.querySelectorAll('a, .group-header'));
          function place(el){
            if(!el) return;
            var rect = el.getBoundingClientRect();
            var asideRect = aside.getBoundingClientRect();
            var top = rect.top - asideRect.top + (window.scrollY || 0);
            indicator.style.top = (top + 6) + 'px';
            indicator.style.height = Math.max(36, rect.height - 8) + 'px';
            indicator.style.opacity = 1;
          }
          // show indicator on hover
          items.forEach(function(it){
            it.addEventListener('mouseenter', function(){ place(it); });
          });
          // hide when leaving aside
          aside.addEventListener('mouseleave', function(){ indicator.style.opacity = 0; });
          // keep indicator on the active link if present
          var active = aside.querySelector('.active-link');
          if(active) place(active);
        })();
      });
  </script>
</body>
</html>
